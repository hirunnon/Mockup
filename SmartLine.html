<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMART LINE - Production Monitor System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        industrial: {
                            bg: '#0f172a',
                            panel: '#1e293b',
                            border: '#334155',
                            text: '#f1f5f9',
                            accent: '#3b82f6',
                            success: '#22c55e',
                            warning: '#eab308',
                            error: '#ef4444',
                            idle: '#94a3b8',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19",
    "react-dom/client": "https://esm.sh/react-dom@19/client",
    "react-router-dom": "https://esm.sh/react-router-dom@7",
    "lucide-react": "https://esm.sh/lucide-react@0.563"
  }
}
  </script>
</head>

<body class="bg-industrial-bg text-industrial-text overflow-hidden">
    <div id="root">
        <div class="flex items-center justify-center h-screen">
            <div class="text-center">
                <div class="text-4xl font-bold text-blue-500 mb-4">กำลังโหลด SMART LINE...</div>
                <div class="text-gray-400">กรุณารอสักครู่</div>
            </div>
        </div>
    </div>
    <script type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { HashRouter, Routes, Route, Link, useLocation, useParams, useNavigate } from 'react-router-dom';
        import { Monitor, FileText, Menu, X, Activity, AlertTriangle, Clock, Zap, ArrowLeft, Settings, RefreshCw, Download, Calendar, Box, Search, ChevronLeft, ChevronRight, ChevronsLeft, ChevronsRight } from 'lucide-react';

        // ==================== CONSTANTS ====================
        const StationStatus = {
            IDLE: 'IDLE',
            RUNNING: 'RUNNING',
            OK: 'OK',
            NG: 'NG',
            OFFLINE: 'OFFLINE',
            OK_NG: 'OK (NG)',
            PASS: 'PASS'
        };

        const TOTAL_STATIONS = 30;
        const MODELS = ['K2JL', 'K3FG', 'H5-TURBO'];

        // ==================== DATA GENERATION ====================
        const generateInitialStations = () => {
            return Array.from({ length: TOTAL_STATIONS }, (_, i) => {
                const num = i + 1;
                return {
                    id: `ST-${num.toString().padStart(2, '0')}`,
                    index: num,
                    name: `OP-${num * 10}`,
                    status: StationStatus.IDLE,
                    cycleTime: 0,
                    totalCount: 0,
                    ngCount: 0,
                    lastUpdate: new Date().toISOString(),
                    currentModel: '-',
                    currentFrameNo: '-',
                    temperature: 30
                };
            });
        };

        const simulateLiveUpdate = (stations) => {
            return stations.map(station => {
                if (Math.random() > 0.8) {
                    const isActive = Math.random() > 0.3;
                    if (!isActive) return { ...station, status: StationStatus.IDLE };

                    const model = MODELS[Math.floor(Math.random() * MODELS.length)];
                    const frameNo = `TH${1000 + Math.floor(Math.random() * 9999)}`;
                    const statuses = [StationStatus.RUNNING, StationStatus.OK, StationStatus.RUNNING, StationStatus.OK, StationStatus.NG];
                    const newStatus = statuses[Math.floor(Math.random() * statuses.length)];

                    let newTotal = station.totalCount;
                    let newNg = station.ngCount;
                    if (newStatus === StationStatus.OK) newTotal++;
                    if (newStatus === StationStatus.NG) { newTotal++; newNg++; }

                    return {
                        ...station,
                        status: newStatus,
                        currentModel: model,
                        currentFrameNo: frameNo,
                        totalCount: newTotal,
                        ngCount: newNg,
                        cycleTime: newStatus === StationStatus.RUNNING ? Math.floor(Math.random() * 15) + 15 : station.cycleTime,
                        lastUpdate: new Date().toISOString(),
                        temperature: 30 + Math.random() * 5
                    };
                }
                return station;
            });
        };

        const generateTraceabilityData = () => {
            const records = [];
            for (let i = 0; i < 50; i++) {
                const model = MODELS[Math.floor(Math.random() * MODELS.length)];
                const frameNo = `TH${1000 + i}`;
                const stationData = {};
                const stationTimes = {};
                let totalTime = 0;
                let hasFault = false;

                for (let j = 1; j <= 20; j++) {
                    const sId = `ST-${j.toString().padStart(2, '0')}`;
                    const time = Math.floor(Math.random() * 4) + 2;
                    stationTimes[sId] = time;
                    totalTime += time;

                    const rand = Math.random();
                    let status = StationStatus.OK;
                    if (rand > 0.95) { status = StationStatus.NG; hasFault = true; }
                    else if (rand > 0.90) { status = StationStatus.PASS; hasFault = true; }
                    else if (rand > 0.85) status = StationStatus.OK_NG;

                    stationData[sId] = status;
                }

                records.push({
                    frameNo,
                    model,
                    startTime: new Date(Date.now() - i * 1000 * 60 * 5).toISOString(),
                    stations: stationData,
                    stationTimes,
                    judge: hasFault ? 'NG' : 'OK',
                    totalTime
                });
            }
            return records;
        };

        const getTraceabilityByFrame = (frameNo, currentStationIndex) => {
            const maxStations = currentStationIndex || Math.floor(Math.random() * 20) + 5;
            const stationData = {};
            const stationTimes = {};
            let totalTime = 0;
            let hasFault = false;

            for (let j = 1; j <= 30; j++) {
                if (j > maxStations) break;
                const sId = `ST-${j.toString().padStart(2, '0')}`;
                const time = Math.floor(Math.random() * 10) + 20;
                stationTimes[sId] = time;
                totalTime += time;

                const rand = Math.random();
                let status = StationStatus.OK;
                if (rand > 0.95) { status = StationStatus.NG; hasFault = true; }
                else if (rand > 0.92) status = StationStatus.OK_NG;
                stationData[sId] = status;
            }

            return {
                frameNo,
                model: MODELS[Math.floor(Math.random() * MODELS.length)],
                startTime: new Date(Date.now() - 3600000).toISOString(),
                stations: stationData,
                stationTimes,
                judge: hasFault ? 'NG' : 'OK',
                totalTime
            };
        };

        // ==================== COMPONENTS ====================

        // Status Card Component
        const StatusCard = ({ station, onClick }) => {
            const getStatusColor = (status) => {
                switch (status) {
                    case StationStatus.OK: return 'bg-industrial-panel border-green-500/50 shadow-green-900/20';
                    case StationStatus.NG: return 'bg-industrial-panel border-red-500 shadow-red-900/50 animate-pulse';
                    case StationStatus.PASS: return 'bg-industrial-panel border-red-500 shadow-red-900/30';
                    case StationStatus.RUNNING: return 'bg-industrial-panel border-blue-500 shadow-blue-900/30';
                    case StationStatus.IDLE: return 'bg-industrial-panel border-gray-600';
                    default: return 'bg-industrial-panel border-gray-700 opacity-50';
                }
            };

            const getStatusTextColor = (status) => {
                switch (status) {
                    case StationStatus.OK: return 'text-green-400';
                    case StationStatus.NG: return 'text-red-500';
                    case StationStatus.PASS: return 'text-red-500';
                    case StationStatus.RUNNING: return 'text-blue-400';
                    default: return 'text-gray-400';
                }
            };

            const hasFrame = station.currentFrameNo && station.currentFrameNo !== '-';

            return React.createElement('div', {
                onClick: hasFrame ? onClick : undefined,
                className: `relative flex flex-col p-3 rounded-lg border-l-4 shadow-lg transition-all ${getStatusColor(station.status)} ${hasFrame ? 'cursor-pointer hover:bg-white/5' : ''}`
            },
                React.createElement('div', { className: 'flex justify-between items-start mb-2' },
                    React.createElement('div', null,
                        React.createElement('h3', { className: 'text-sm font-bold text-gray-300' }, station.name),
                        React.createElement('p', { className: 'text-xs text-gray-500' }, station.id)
                    ),
                    React.createElement('div', { className: `text-xs font-bold px-2 py-0.5 rounded ${getStatusTextColor(station.status)} bg-opacity-10 bg-white` }, station.status)
                ),
                React.createElement('div', { className: 'bg-black/40 rounded p-2 mb-2' },
                    React.createElement('div', { className: 'flex justify-between text-xs mb-1' },
                        React.createElement('span', { className: 'text-gray-500' }, 'Model:'),
                        React.createElement('span', { className: 'text-yellow-400 font-mono font-bold' }, station.currentModel || '-')
                    ),
                    React.createElement('div', { className: 'flex justify-between text-sm' },
                        React.createElement('span', { className: 'text-gray-500' }, 'Frame:'),
                        React.createElement('span', { className: 'text-white font-mono font-bold' }, station.currentFrameNo || '-')
                    )
                ),
                React.createElement('div', { className: 'grid grid-cols-2 gap-2 text-xs text-gray-400 mt-auto' },
                    React.createElement('div', { className: 'flex flex-col' },
                        React.createElement('span', null, 'CT'),
                        React.createElement('span', { className: 'font-mono text-white' }, `${station.cycleTime}s`)
                    ),
                    React.createElement('div', { className: 'flex flex-col text-right' },
                        React.createElement('span', null, 'Total'),
                        React.createElement('span', { className: 'font-mono text-white' }, station.totalCount)
                    )
                ),
                hasFrame && React.createElement('div', { className: 'absolute bottom-2 right-2 opacity-0 hover:opacity-100 transition-opacity' },
                    React.createElement(Zap, { size: 12, className: 'text-blue-400' })
                )
            );
        };

        // Dashboard TV Page
        const DashboardTV = ({ stations }) => {
            const navigate = useNavigate();
            const displayStations = stations.slice(0, 24);
            const runningCount = stations.filter(s => s.status === StationStatus.RUNNING).length;
            const ngCount = stations.filter(s => s.status === StationStatus.NG || s.status === StationStatus.PASS).length;

            return React.createElement('div', { className: 'h-full flex flex-col gap-4' },
                React.createElement('div', { className: 'grid grid-cols-4 gap-4' },
                    React.createElement('div', { className: 'bg-blue-900/30 border border-blue-500/30 p-4 rounded-lg flex items-center gap-4' },
                        React.createElement('div', { className: 'p-3 bg-blue-500/20 rounded-full text-blue-400' }, React.createElement(Activity)),
                        React.createElement('div', null,
                            React.createElement('div', { className: 'text-sm text-gray-400' }, 'Running Stations'),
                            React.createElement('div', { className: 'text-2xl font-bold text-white' }, runningCount)
                        )
                    ),
                    React.createElement('div', { className: 'bg-red-900/30 border border-red-500/30 p-4 rounded-lg flex items-center gap-4' },
                        React.createElement('div', { className: 'p-3 bg-red-500/20 rounded-full text-red-500' }, React.createElement(AlertTriangle)),
                        React.createElement('div', null,
                            React.createElement('div', { className: 'text-sm text-gray-400' }, 'Current Alarms'),
                            React.createElement('div', { className: 'text-2xl font-bold text-white' }, ngCount)
                        )
                    ),
                    React.createElement('div', { className: 'bg-green-900/30 border border-green-500/30 p-4 rounded-lg flex items-center gap-4' },
                        React.createElement('div', { className: 'p-3 bg-green-500/20 rounded-full text-green-500' }, React.createElement(Zap)),
                        React.createElement('div', null,
                            React.createElement('div', { className: 'text-sm text-gray-400' }, 'Target / Actual'),
                            React.createElement('div', { className: 'text-2xl font-bold text-white' }, '450 / 382')
                        )
                    ),
                    React.createElement('div', { className: 'bg-industrial-panel border border-gray-700 p-4 rounded-lg flex items-center gap-4' },
                        React.createElement('div', { className: 'p-3 bg-gray-700 rounded-full text-gray-400' }, React.createElement(Clock)),
                        React.createElement('div', null,
                            React.createElement('div', { className: 'text-sm text-gray-400' }, 'Takt Time'),
                            React.createElement('div', { className: 'text-2xl font-bold text-white' }, '58.2s')
                        )
                    )
                ),
                React.createElement('div', { className: 'flex-1 overflow-y-auto' },
                    React.createElement('h2', { className: 'text-gray-400 text-sm mb-2 uppercase tracking-wider' }, 'Production Line Status (Station 01 - 24)'),
                    React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3 pb-4' },
                        displayStations.map((station) =>
                            React.createElement(StatusCard, {
                                key: station.id,
                                station: station,
                                onClick: () => navigate(`/trace/${station.currentFrameNo}`)
                            })
                        )
                    )
                )
            );
        };

        // Station HMI Page
        const StationHMI = ({ stations }) => {
            const { id } = useParams();
            const station = stations.find(s => s.id === id);
            if (!station) return React.createElement('div', { className: 'text-white p-10' }, 'Station not found');

            const getStatusColor = (status) => {
                switch (status) {
                    case StationStatus.OK: return 'bg-green-500';
                    case StationStatus.NG: return 'bg-red-600';
                    case StationStatus.PASS: return 'bg-red-500';
                    case StationStatus.RUNNING: return 'bg-blue-600';
                    case StationStatus.IDLE: return 'bg-yellow-500 text-black';
                    default: return 'bg-gray-600';
                }
            };

            return React.createElement('div', { className: 'fixed inset-0 bg-black text-white flex flex-col z-50' },
                React.createElement('div', { className: 'h-16 bg-industrial-panel flex items-center justify-between px-6 border-b border-gray-700' },
                    React.createElement(Link, { to: '/', className: 'bg-gray-700 hover:bg-gray-600 p-2 rounded flex items-center gap-2' },
                        React.createElement(ArrowLeft),
                        React.createElement('span', { className: 'text-sm font-bold' }, 'BACK')
                    ),
                    React.createElement('div', { className: 'text-2xl font-bold' }, station.name),
                    React.createElement('div', { className: 'text-gray-400 text-sm' }, new Date().toLocaleTimeString())
                ),
                React.createElement('div', { className: 'flex-1 flex p-2 gap-2' },
                    React.createElement('div', { className: 'w-1/2 flex flex-col gap-2' },
                        React.createElement('div', { className: `flex-1 rounded-xl flex items-center justify-center shadow-inner ${getStatusColor(station.status)}` },
                            React.createElement('div', { className: 'text-center' },
                                React.createElement('div', { className: 'text-8xl font-black tracking-widest uppercase drop-shadow-md' }, station.status),
                                React.createElement('div', { className: 'text-2xl mt-4 font-bold opacity-80 uppercase' }, 'Current State')
                            )
                        ),
                        React.createElement('div', { className: 'h-1/3 grid grid-cols-2 gap-2' },
                            React.createElement('button', { className: 'bg-industrial-panel border-2 border-industrial-border rounded-lg active:bg-blue-600 active:border-blue-400 flex flex-col items-center justify-center' },
                                React.createElement(Settings, { size: 32, className: 'mb-2 text-gray-400' }),
                                React.createElement('span', { className: 'font-bold text-lg' }, 'MAINTENANCE')
                            ),
                            React.createElement('button', { className: 'bg-industrial-panel border-2 border-industrial-border rounded-lg active:bg-yellow-600 active:border-yellow-400 flex flex-col items-center justify-center' },
                                React.createElement(AlertTriangle, { size: 32, className: 'mb-2 text-yellow-500' }),
                                React.createElement('span', { className: 'font-bold text-lg' }, 'CALL HELP')
                            )
                        )
                    ),
                    React.createElement('div', { className: 'w-1/2 flex flex-col gap-2' },
                        React.createElement('div', { className: 'flex-1 bg-industrial-panel rounded-xl border border-gray-700 p-6 flex flex-col justify-center' },
                            React.createElement('div', { className: 'flex justify-between items-end border-b border-gray-600 pb-2 mb-4' },
                                React.createElement('span', { className: 'text-gray-400 text-xl' }, 'Model'),
                                React.createElement('span', { className: 'text-3xl font-mono font-bold text-blue-400' }, station.currentModel || '-')
                            ),
                            React.createElement('div', { className: 'flex justify-between items-end border-b border-gray-600 pb-2 mb-4' },
                                React.createElement('span', { className: 'text-gray-400 text-xl' }, 'Cycle Time'),
                                React.createElement('div', { className: 'flex items-baseline gap-2' },
                                    React.createElement('span', { className: 'text-6xl font-mono font-bold' }, station.cycleTime.toFixed(1)),
                                    React.createElement('span', { className: 'text-gray-500' }, 'sec')
                                )
                            ),
                            React.createElement('div', { className: 'flex justify-between items-end border-b border-gray-600 pb-2 mb-4' },
                                React.createElement('span', { className: 'text-gray-400 text-xl' }, 'Total Output'),
                                React.createElement('span', { className: 'text-6xl font-mono font-bold text-white' }, station.totalCount)
                            ),
                            React.createElement('div', { className: 'flex justify-between items-end' },
                                React.createElement('span', { className: 'text-gray-400 text-xl' }, 'NG Count'),
                                React.createElement('span', { className: 'text-6xl font-mono font-bold text-red-500' }, station.ngCount)
                            )
                        ),
                        React.createElement('div', { className: 'h-1/4 bg-industrial-panel rounded-xl border border-gray-700 p-4 flex items-center justify-between' },
                            React.createElement('div', { className: 'flex items-center gap-4' },
                                React.createElement('div', { className: 'p-3 bg-gray-800 rounded-lg' },
                                    React.createElement(RefreshCw, { className: station.status === StationStatus.RUNNING ? 'animate-spin' : '' })
                                ),
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'text-sm text-gray-400' }, 'Last Update'),
                                    React.createElement('div', { className: 'font-mono text-sm' }, new Date(station.lastUpdate).toLocaleTimeString())
                                )
                            ),
                            React.createElement('div', { className: 'text-right' },
                                React.createElement('div', { className: 'text-sm text-gray-400' }, 'Temp'),
                                React.createElement('div', { className: 'font-mono text-xl font-bold' }, `${station.temperature?.toFixed(1)}°C`)
                            )
                        )
                    )
                )
            );
        };

        // Traceability Page - SVG Map
        const LayoutMap = ({ stations }) => {
            const { frameNo } = useParams();
            const [record, setRecord] = useState(null);

            useEffect(() => {
                if (frameNo) {
                    const currentLiveStation = stations.find(s => s.currentFrameNo === frameNo);
                    const limitIndex = currentLiveStation ? currentLiveStation.index : undefined;
                    setRecord(getTraceabilityByFrame(frameNo, limitIndex));
                }
            }, [frameNo, stations]);

            const width = 1200;
            const height = 600;

            const getCoordinates = (index) => {
                const xGap = 100;
                const yGap = 150;
                const marginX = 100;
                const marginY = 100;

                const row = Math.floor(index / 10);
                const col = index % 10;

                let x = 0;
                let y = marginY + row * yGap;

                if (row % 2 === 0) {
                    x = marginX + col * xGap;
                } else {
                    x = marginX + (9 - col) * xGap;
                }

                return { x, y };
            };

            const getHistoryStatusColor = (status) => {
                switch (status) {
                    case StationStatus.OK: return '#22c55e';
                    case StationStatus.OK_NG: return '#eab308';
                    case StationStatus.NG: return '#ef4444';
                    case StationStatus.PASS: return '#ef4444';
                    default: return '#1e293b';
                }
            };

            if (!frameNo || !record) {
                return React.createElement('div', { className: 'text-gray-400 p-10' }, 'Loading traceability data...');
            }

            return React.createElement('div', { className: 'h-full bg-industrial-panel rounded-lg border border-industrial-border flex flex-col relative overflow-hidden' },
                // Header Overlay
                React.createElement('div', { className: 'absolute top-4 left-4 z-10 w-full max-w-lg pointer-events-none' },
                    React.createElement('div', { className: 'bg-black/80 backdrop-blur px-6 py-4 rounded border border-gray-700 shadow-2xl pointer-events-auto' },
                        React.createElement('div', { className: 'flex items-center gap-3 mb-2' },
                            React.createElement(Link, { to: '/', className: 'text-gray-400 hover:text-white transition-colors' },
                                React.createElement(ArrowLeft, { size: 20 })
                            ),
                            React.createElement('h2', { className: 'text-xl font-bold text-white tracking-wide' }, 'Frame Traceability')
                        ),
                        React.createElement('div', { className: 'grid grid-cols-2 gap-4 text-sm' },
                            React.createElement('div', null,
                                React.createElement('div', { className: 'text-gray-500 text-xs' }, 'Frame No.'),
                                React.createElement('div', { className: 'text-blue-400 font-mono font-bold text-lg' }, record.frameNo)
                            ),
                            React.createElement('div', null,
                                React.createElement('div', { className: 'text-gray-500 text-xs' }, 'Model'),
                                React.createElement('div', { className: 'text-white font-mono font-bold' }, record.model)
                            ),
                            React.createElement('div', null,
                                React.createElement('div', { className: 'text-gray-500 text-xs' }, 'Final Judge'),
                                React.createElement('div', { className: `font-bold ${record.judge === 'OK' ? 'text-green-500' : 'text-red-500'}` }, record.judge)
                            ),
                            React.createElement('div', null,
                                React.createElement('div', { className: 'text-gray-500 text-xs' }, 'Total Cycle Time'),
                                React.createElement('div', { className: 'text-white font-mono' }, `${record.totalTime}s`)
                            )
                        )
                    )
                ),
                // SVG Container
                React.createElement('div', { className: 'flex-1 overflow-auto flex items-center justify-center bg-[#18181b] p-10 relative' },
                    React.createElement('svg', { width, height, viewBox: `0 0 ${width} ${height}`, className: 'bg-[#18181b]' },
                        // Defs
                        React.createElement('defs', null,
                            React.createElement('marker', { id: 'arrow', markerWidth: '10', markerHeight: '10', refX: '28', refY: '3', orient: 'auto', markerUnits: 'strokeWidth' },
                                React.createElement('path', { d: 'M0,0 L0,6 L9,3 z', fill: '#334155' })
                            ),
                            React.createElement('filter', { id: 'glow', x: '-20%', y: '-20%', width: '140%', height: '140%' },
                                React.createElement('feGaussianBlur', { stdDeviation: '3', result: 'blur' }),
                                React.createElement('feComposite', { in: 'SourceGraphic', in2: 'blur', operator: 'over' })
                            )
                        ),
                        // Connecting Path
                        React.createElement('path', {
                            d: `M 100 100 L 1000 100 Q 1100 100 1100 175 Q 1100 250 1000 250 L 100 250 Q 0 250 0 325 Q 0 400 100 400 L 1000 400`,
                            fill: 'none',
                            stroke: '#1e293b',
                            strokeWidth: '10',
                            strokeLinecap: 'round'
                        }),
                        // Stations
                        Array.from({ length: 30 }).map((_, index) => {
                            const num = index + 1;
                            const stationId = `ST-${num.toString().padStart(2, '0')}`;
                            const { x, y } = getCoordinates(index);
                            const status = record.stations[stationId];
                            const time = record.stationTimes[stationId];
                            const hasData = !!status;
                            const color = getHistoryStatusColor(status);
                            const isAlarm = status === StationStatus.NG || status === StationStatus.PASS;

                            return React.createElement('g', { key: stationId, className: 'group cursor-default' },
                                // Circle
                                React.createElement('circle', {
                                    cx: x,
                                    cy: y,
                                    r: '22',
                                    fill: hasData ? color : '#0f172a',
                                    stroke: hasData ? 'white' : '#334155',
                                    strokeWidth: isAlarm ? 3 : 1,
                                    filter: isAlarm ? 'url(#glow)' : '',
                                    className: 'transition-all duration-300'
                                }),
                                // Number
                                React.createElement('text', {
                                    x,
                                    y: y + 5,
                                    textAnchor: 'middle',
                                    fill: hasData ? 'white' : '#475569',
                                    fontSize: '12',
                                    fontWeight: 'bold',
                                    pointerEvents: 'none'
                                }, num),
                                // Info Box
                                hasData ? React.createElement('g', null,
                                    React.createElement('rect', {
                                        x: x - 35,
                                        y: y + 35,
                                        width: '70',
                                        height: '40',
                                        rx: '4',
                                        fill: '#1e293b',
                                        stroke: color,
                                        strokeWidth: '1',
                                        className: 'opacity-90'
                                    }),
                                    React.createElement('text', { x, y: y + 50, textAnchor: 'middle', fill: '#94a3b8', fontSize: '10' },
                                        status === StationStatus.OK_NG ? 'OK(NG)' : status
                                    ),
                                    React.createElement('text', { x, y: y + 65, textAnchor: 'middle', fill: 'white', fontSize: '10', fontWeight: 'bold' },
                                        `${time}s`
                                    )
                                ) : React.createElement('text', { x, y: y + 45, textAnchor: 'middle', fill: '#334155', fontSize: '10' }, 'Pending')
                            );
                        })
                    )
                ),
                // Legend
                React.createElement('div', { className: 'absolute bottom-4 right-4 bg-black/60 p-4 rounded text-xs flex flex-col gap-2 border border-gray-700' },
                    React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('div', { className: 'w-3 h-3 rounded-full bg-green-500' }),
                        React.createElement('span', { className: 'text-gray-300' }, 'OK')
                    ),
                    React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('div', { className: 'w-3 h-3 rounded-full bg-yellow-500' }),
                        React.createElement('span', { className: 'text-gray-300' }, 'OK (NG Fixed)')
                    ),
                    React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('div', { className: 'w-3 h-3 rounded-full bg-red-500' }),
                        React.createElement('span', { className: 'text-gray-300' }, 'NG / Fault')
                    ),
                    React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('div', { className: 'w-3 h-3 rounded-full bg-slate-800 border border-slate-600' }),
                        React.createElement('span', { className: 'text-gray-500' }, 'Pending')
                    )
                )
            );
        };

        // Report Data Page
        const ReportData = () => {
            const [data, setData] = useState([]);
            const [selectedModel, setSelectedModel] = useState('All');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [currentPage, setCurrentPage] = useState(1);
            const [rowsPerPage, setRowsPerPage] = useState(10);

            useEffect(() => {
                setData(generateTraceabilityData());
            }, []);

            const stationColumns = Array.from({ length: 20 }, (_, i) => i + 1);

            const filteredData = useMemo(() => {
                return data.filter(record => {
                    const matchModel = selectedModel === 'All' || record.model === selectedModel;
                    const recordDate = new Date(record.startTime).toISOString().split('T')[0];
                    const matchDate = !selectedDate || recordDate === selectedDate;
                    return matchModel && matchDate;
                });
            }, [data, selectedModel, selectedDate]);

            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            const paginatedData = useMemo(() => {
                const start = (currentPage - 1) * rowsPerPage;
                return filteredData.slice(start, start + rowsPerPage);
            }, [filteredData, currentPage, rowsPerPage]);

            const handleExport = () => {
                if (filteredData.length === 0) {
                    alert("ไม่มีข้อมูลให้ Export");
                    return;
                }

                const headers = [
                    "FRAME NO",
                    "MODEL",
                    "START TIME",
                    ...stationColumns.map(n => `ST-${n} STATUS`),
                    "JUDGE",
                    ...stationColumns.map(n => `ST-${n} TIME(s)`),
                    "TOTAL TIME(s)"
                ];

                const rows = filteredData.map(record => {
                    const stStatuses = stationColumns.map(n => {
                        const key = `ST-${n.toString().padStart(2, '0')}`;
                        return record.stations[key] || '-';
                    });
                    const stTimes = stationColumns.map(n => {
                        const key = `ST-${n.toString().padStart(2, '0')}`;
                        return record.stationTimes[key] || 0;
                    });
                    return [
                        record.frameNo,
                        record.model,
                        `"${new Date(record.startTime).toLocaleString()}"`,
                        ...stStatuses,
                        record.judge,
                        ...stTimes,
                        record.totalTime
                    ].join(",");
                });

                const csvContent = [headers.join(","), ...rows].join("\\n");
                const blob = new Blob(["\\uFEFF" + csvContent], { type: "text/csv;charset=utf-8;" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url;
                link.download = `Production_Log_${selectedDate || 'all'}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const getStatusDisplay = (status) => {
                if (!status) return { content: '-', className: 'text-gray-600' };
                switch (status) {
                    case StationStatus.OK: return { content: 'OK', className: 'bg-green-600 text-white font-bold' };
                    case StationStatus.NG: return { content: 'NG', className: 'bg-red-600 text-white font-bold' };
                    case StationStatus.PASS: return { content: 'Pass', className: 'bg-red-600 text-white font-bold' };
                    case StationStatus.OK_NG: return {
                        content: React.createElement('div', { className: 'flex flex-col items-center justify-center leading-none' },
                            React.createElement('span', { className: 'mb-[1px]' }, 'OK'),
                            React.createElement('span', { className: 'text-[9px]' }, '(NG)')
                        ),
                        className: 'bg-yellow-600 text-white font-bold text-xs'
                    };
                    default: return { content: status, className: 'text-gray-400' };
                }
            };

            return React.createElement('div', { className: 'flex flex-col h-full gap-4' },
                React.createElement('div', { className: 'bg-industrial-panel p-4 rounded-lg border border-industrial-border flex flex-wrap gap-4 justify-between items-center' },
                    React.createElement('div', null,
                        React.createElement('h2', { className: 'font-bold text-lg text-white' }, 'รายงานการผลิต'),
                        React.createElement('p', { className: 'text-sm text-gray-400' }, 'Production Traceability Log')
                    ),
                    React.createElement('div', { className: 'flex flex-wrap items-center gap-4' },
                        React.createElement('div', { className: 'flex items-center gap-2 bg-industrial-bg px-3 py-2 rounded border border-industrial-border' },
                            React.createElement(Box, { size: 16, className: 'text-blue-400' }),
                            React.createElement('span', { className: 'text-gray-400 text-xs' }, 'Model:'),
                            React.createElement('select', {
                                value: selectedModel,
                                onChange: (e) => setSelectedModel(e.target.value),
                                className: 'bg-transparent border-none focus:outline-none text-sm text-white cursor-pointer'
                            },
                                React.createElement('option', { value: 'All', className: 'bg-industrial-panel' }, 'All Models'),
                                React.createElement('option', { value: 'K2JL', className: 'bg-industrial-panel' }, 'K2JL'),
                                React.createElement('option', { value: 'K3FG', className: 'bg-industrial-panel' }, 'K3FG'),
                                React.createElement('option', { value: 'H5-TURBO', className: 'bg-industrial-panel' }, 'H5-TURBO')
                            )
                        ),
                        React.createElement('div', { className: 'flex items-center gap-2 bg-industrial-bg px-3 py-2 rounded border border-industrial-border' },
                            React.createElement(Calendar, { size: 16, className: 'text-green-400' }),
                            React.createElement('input', {
                                type: 'date',
                                value: selectedDate,
                                onChange: (e) => setSelectedDate(e.target.value),
                                className: 'bg-transparent border-none focus:outline-none text-sm text-white cursor-pointer',
                                style: { colorScheme: 'dark' }
                            })
                        ),
                        React.createElement('button', {
                            onClick: handleExport,
                            className: 'flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded text-sm transition-colors'
                        },
                            React.createElement(Download, { size: 16 }),
                            ' Export CSV'
                        )
                    )
                ),
                React.createElement('div', { className: 'flex-1 bg-industrial-panel rounded-lg border border-industrial-border overflow-auto' },
                    React.createElement('table', { className: 'w-full text-center text-sm border-collapse min-w-[1400px]' },
                        React.createElement('thead', { className: 'bg-industrial-bg text-gray-400 font-bold text-xs sticky top-0 z-40 shadow-md' },
                            React.createElement('tr', null,
                                React.createElement('th', { className: 'p-3 border-b border-r border-gray-700 text-center sticky left-0 bg-industrial-bg z-50 w-[75px] min-w-[75px] max-w-[75px] text-gray-300Shadow-[2px_0_5px_rgba(0,0,0,0.3)]' }, 'FRAME NO.'),
                                ...stationColumns.map(num =>
                                    React.createElement('th', { key: num, className: 'p-1 border-b border-gray-700 w-9 min-w-[36px] border-l border-gray-800 text-gray-400 text-[10px]' },
                                        React.createElement('div', null, 'ST'),
                                        React.createElement('div', null, num)
                                    )
                                ),
                                React.createElement('th', { className: 'p-1 border-b border-l border-gray-700 w-[60px] min-w-[60px] sticky right-0 bg-industrial-bg z-50 text-gray-300 text-[10px] shadow-[-2px_0_5px_rgba(0,0,0,0.3)]' },
                                    React.createElement('div', null, 'JUDGE'),
                                    React.createElement('span', { className: 'text-[9px] text-gray-500 font-normal' }, 'TIME')
                                )
                            )
                        ),
                        React.createElement('tbody', { className: 'divide-y divide-gray-700' },
                            paginatedData.length === 0 ?
                                React.createElement('tr', null,
                                    React.createElement('td', { colSpan: 22, className: 'p-10 text-gray-500' }, 'ไม่พบข้อมูล')
                                ) :
                                paginatedData.map((row, idx) => {
                                    const isEven = idx % 2 === 0;
                                    const rowBgClass = isEven ? 'bg-industrial-bg' : 'bg-industrial-panel';

                                    return React.createElement(React.Fragment, { key: idx },
                                        // Status Row
                                        React.createElement('tr', { className: `${rowBgClass} transition-colors hover:bg-opacity-80 group` },
                                            React.createElement('td', { className: `p-1 text-left font-mono font-bold text-blue-400 sticky left-0 border-r border-gray-700 z-30 align-middle shadow-[2px_0_5px_rgba(0,0,0,0.3)] ${rowBgClass} w-[75px] min-w-[75px] max-w-[75px]` },
                                                React.createElement('div', { className: 'text-[10px] break-all leading-tight' }, row.frameNo),
                                                React.createElement('div', { className: 'text-[9px] text-gray-500 font-normal mt-0.5 truncate' }, row.model)
                                            ),
                                            ...stationColumns.map(num => {
                                                const stId = `ST-${num.toString().padStart(2, '0')}`;
                                                const status = row.stations[stId];
                                                const { content, className } = getStatusDisplay(status);
                                                return React.createElement('td', { key: `st-${stId}`, className: 'p-[2px] border-l border-gray-700/50 align-middle' },
                                                    React.createElement('div', { className: `w-full h-8 flex items-center justify-center rounded ${className} text-[10px]` }, content)
                                                );
                                            }),
                                            React.createElement('td', { className: `p-1 sticky right-0 z-30 border-l border-gray-700 font-bold align-middle shadow-[-2px_0_5px_rgba(0,0,0,0.3)] ${rowBgClass} w-[60px] min-w-[60px]` },
                                                React.createElement('div', { className: `mx-auto px-1 py-1 rounded w-full h-6 flex items-center justify-center text-[10px] ${row.judge === 'NG' ? 'bg-red-600/20 text-red-500 border border-red-500/50' : 'text-green-500'}` }, row.judge)
                                            )
                                        ),
                                        // Time Row
                                        React.createElement('tr', { className: `${rowBgClass} border-b border-gray-700 group` },
                                            React.createElement('td', { className: `p-1 text-right text-[9px] text-gray-500 sticky left-0 border-r border-gray-700 z-30 font-mono shadow-[2px_0_5px_rgba(0,0,0,0.3)] ${rowBgClass} w-[75px] min-w-[75px] max-w-[75px]` },
                                                new Date(row.startTime).toLocaleString('th-TH', { month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })
                                            ),
                                            ...stationColumns.map(num => {
                                                const stId = `ST-${num.toString().padStart(2, '0')}`;
                                                const time = row.stationTimes[stId];
                                                return React.createElement('td', { key: `time-${stId}`, className: 'p-[2px] border-l border-gray-700/50 text-[10px] text-gray-400 font-mono' }, time || '-');
                                            }),
                                            React.createElement('td', { className: `p-1 sticky right-0 z-30 border-l border-gray-700 align-middle text-right font-mono text-xs text-white shadow-[-2px_0_5px_rgba(0,0,0,0.3)] ${rowBgClass} w-[60px] min-w-[60px]` },
                                                React.createElement('div', { className: 'pr-1' }, `${row.totalTime}s`)
                                            )
                                        )
                                    );
                                })
                        )
                    )
                ),
                React.createElement('div', { className: 'flex justify-between items-center bg-industrial-panel p-3 rounded-lg border border-industrial-border' },
                    React.createElement('div', { className: 'flex items-center gap-3 text-sm text-gray-400' },
                        React.createElement('span', null, 'แสดง'),
                        React.createElement('select', {
                            value: rowsPerPage,
                            onChange: (e) => setRowsPerPage(Number(e.target.value)),
                            className: 'bg-industrial-bg border border-gray-600 rounded px-2 py-1 text-white text-xs'
                        },
                            React.createElement('option', { value: 10 }, '10'),
                            React.createElement('option', { value: 20 }, '20'),
                            React.createElement('option', { value: 50 }, '50')
                        ),
                        React.createElement('span', null, `รายการ / หน้า (ทั้งหมด ${filteredData.length} รายการ)`)
                    ),
                    React.createElement('div', { className: 'flex items-center gap-2' },
                        React.createElement('button', {
                            onClick: () => setCurrentPage(1),
                            disabled: currentPage === 1,
                            className: 'p-1 rounded hover:bg-gray-700 disabled:opacity-30 text-gray-300'
                        }, React.createElement(ChevronsLeft, { size: 18 })),
                        React.createElement('button', {
                            onClick: () => setCurrentPage(p => Math.max(1, p - 1)),
                            disabled: currentPage === 1,
                            className: 'p-1 rounded hover:bg-gray-700 disabled:opacity-30 text-gray-300'
                        }, React.createElement(ChevronLeft, { size: 18 })),
                        React.createElement('span', { className: 'text-sm text-white px-3' }, `หน้า ${currentPage} / ${totalPages || 1}`),
                        React.createElement('button', {
                            onClick: () => setCurrentPage(p => Math.min(totalPages, p + 1)),
                            disabled: currentPage === totalPages || totalPages === 0,
                            className: 'p-1 rounded hover:bg-gray-700 disabled:opacity-30 text-gray-300'
                        }, React.createElement(ChevronRight, { size: 18 })),
                        React.createElement('button', {
                            onClick: () => setCurrentPage(totalPages),
                            disabled: currentPage === totalPages || totalPages === 0,
                            className: 'p-1 rounded hover:bg-gray-700 disabled:opacity-30 text-gray-300'
                        }, React.createElement(ChevronsRight, { size: 18 }))
                    )
                )
            );
        };

        // Main App
        const SidebarItem = ({ to, icon: Icon, label, active }) =>
            React.createElement(Link, {
                to,
                className: `flex items-center gap-3 px-4 py-3 rounded-lg transition-colors mb-1 ${active
                    ? 'bg-industrial-accent text-white shadow-lg shadow-blue-500/20'
                    : 'text-gray-400 hover:bg-industrial-border hover:text-white'
                    }`
            },
                React.createElement(Icon, { size: 20 }),
                React.createElement('span', { className: 'font-medium' }, label)
            );

        const AppContent = () => {
            const [stations, setStations] = useState(generateInitialStations());
            const location = useLocation();
            const [isSidebarOpen, setSidebarOpen] = useState(true);

            useEffect(() => {
                const interval = setInterval(() => {
                    setStations(prev => simulateLiveUpdate(prev));
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            const isHMIMode = location.pathname.includes('/station/');

            return React.createElement('div', { className: 'flex h-screen bg-industrial-bg text-industrial-text' },
                !isHMIMode && React.createElement('aside', {
                    className: `${isSidebarOpen ? 'w-64' : 'w-20'} bg-industrial-panel border-r border-industrial-border flex flex-col transition-all duration-300 z-50`
                },
                    React.createElement('div', { className: 'h-16 flex items-center justify-between px-4 border-b border-industrial-border' },
                        isSidebarOpen ? React.createElement('div', { className: 'flex items-center gap-2' },
                            React.createElement('div', { className: 'w-10 h-10 flex items-center justify-center p-1 rounded-sm' },
                                React.createElement('img', {
                                    src: 'https://lezebre.lu/images/detailed/18/Honda_Logo_voiture.png',
                                    alt: 'Honda Logo',
                                    className: 'w-full h-full object-contain',
                                    style: { filter: 'brightness(0) invert(1)' }
                                })
                            ),
                            React.createElement('span', { className: 'font-bold text-lg tracking-wide ml-2' }, 'SMART LINE')
                        ) : React.createElement('div', { className: 'w-10 h-10 flex items-center justify-center p-1 rounded-sm mx-auto' },
                            React.createElement('img', {
                                src: 'https://lezebre.lu/images/detailed/18/Honda_Logo_voiture.png',
                                alt: 'Honda Logo',
                                className: 'w-full h-full object-contain',
                                style: { filter: 'brightness(0) invert(1)' }
                            })
                        ),
                        React.createElement('button', {
                            onClick: () => setSidebarOpen(!isSidebarOpen),
                            className: 'text-gray-400 hover:text-white'
                        }, isSidebarOpen ? React.createElement(X, { size: 20 }) : React.createElement(Menu, { size: 20 }))
                    ),
                    React.createElement('nav', { className: 'flex-1 p-3 overflow-y-auto' },
                        React.createElement(SidebarItem, { to: '/', icon: Monitor, label: isSidebarOpen ? 'TV Dashboard (42")' : '', active: location.pathname === '/' }),
                        React.createElement(SidebarItem, { to: '/report', icon: FileText, label: isSidebarOpen ? 'Production Report' : '', active: location.pathname === '/report' }),
                        isSidebarOpen && React.createElement('div', { className: 'mt-8 px-4' },
                            React.createElement('p', { className: 'text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2' }, 'สถานี'),
                            React.createElement('div', { className: 'grid grid-cols-4 gap-2' },
                                stations.filter(s => s.status !== StationStatus.IDLE).slice(0, 8).map(s =>
                                    React.createElement(Link, {
                                        key: s.id,
                                        to: `/station/${s.id}`,
                                        className: 'bg-industrial-border hover:bg-industrial-accent text-xs text-center py-1 rounded transition-colors'
                                    }, s.id.replace('ST-', ''))
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: 'p-4 border-t border-industrial-border' },
                        React.createElement('div', { className: `flex items-center gap-3 ${!isSidebarOpen && 'justify-center'}` },
                            React.createElement('div', { className: 'w-2 h-2 rounded-full bg-green-500 animate-pulse' }),
                            isSidebarOpen && React.createElement('span', { className: 'text-xs text-gray-400' }, 'System Online')
                        )
                    )
                ),
                React.createElement('main', { className: 'flex-1 flex flex-col overflow-hidden relative' },
                    !isHMIMode && React.createElement('header', { className: 'h-16 bg-industrial-panel border-b border-industrial-border flex items-center justify-between px-6 shadow-md' },
                        React.createElement('h1', { className: 'text-xl font-semibold' },
                            location.pathname === '/' && 'ภาพรวมการผลิต - Main Production Overview',
                            location.pathname.includes('/trace') && 'ติดตามประวัติ - Frame Traceability',
                            location.pathname === '/report' && 'รายงานการผลิต - Production Data Logs'
                        ),
                        React.createElement('div', { className: 'flex items-center gap-4' },
                            React.createElement('div', { className: 'text-right hidden md:block' },
                                React.createElement('div', { className: 'text-sm font-bold' }, new Date().toLocaleTimeString('th-TH')),
                                React.createElement('div', { className: 'text-xs text-gray-400' }, new Date().toLocaleDateString('th-TH'))
                            )
                        )
                    ),
                    React.createElement('div', { className: 'flex-1 overflow-auto bg-industrial-bg p-4 md:p-6' },
                        React.createElement(Routes, null,
                            React.createElement(Route, { path: '/', element: React.createElement(DashboardTV, { stations }) }),
                            React.createElement(Route, { path: '/trace/:frameNo', element: React.createElement(LayoutMap, { stations }) }),
                            React.createElement(Route, { path: '/report', element: React.createElement(ReportData) }),
                            React.createElement(Route, { path: '/station/:id', element: React.createElement(StationHMI, { stations }) })
                        )
                    )
                )
            );
        };

        const App = () => React.createElement(HashRouter, null, React.createElement(AppContent));

        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>

</html>