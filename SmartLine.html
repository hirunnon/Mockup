<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Honda SMART LINE - Production Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ============ TYPES & DATA ============
        const StationStatus = {
            IDLE: 'IDLE', RUNNING: 'RUNNING', OK: 'OK', NG: 'NG',
            OFFLINE: 'OFFLINE', OK_NG: 'OK (NG)', PASS: 'PASS', SKIP: 'SKIP'
        };

        const MODELS = ['K2JL', 'K3FG', 'K1M'];

        const generateInitialStations = () => {
            return Array.from({ length: 30 }, (_, i) => ({
                id: `ST-${(i + 1).toString().padStart(2, '0')}`,
                index: i + 1,
                name: `OP-${(i + 1) * 10}`,
                status: StationStatus.IDLE,
                cycleTime: 0,
                totalCount: 0,
                ngCount: 0,
                lastUpdate: new Date().toISOString(),
                currentModel: '-',
                currentFrameNo: '-',
                temperature: 30
            }));
        };

        const simulateLiveUpdate = (stations) => {
            return stations.map(station => {
                if (Math.random() > 0.8) {
                    const isActive = Math.random() > 0.4;
                    if (!isActive) return { ...station, status: StationStatus.IDLE };

                    const model = MODELS[Math.floor(Math.random() * MODELS.length)];
                    const frameNo = `FR-${Math.floor(Math.random() * 10000)}`;
                    const rand = Math.random();
                    let newStatus = StationStatus.RUNNING;

                    if (rand > 0.95) newStatus = StationStatus.NG;
                    else if (rand > 0.90) newStatus = StationStatus.OK;
                    else if (rand > 0.88) newStatus = StationStatus.SKIP;
                    else if (rand > 0.3) newStatus = StationStatus.RUNNING;
                    else newStatus = StationStatus.OK;

                    let newTotal = station.totalCount;
                    let newNg = station.ngCount;
                    if (newStatus === StationStatus.OK || newStatus === StationStatus.SKIP) newTotal++;
                    if (newStatus === StationStatus.NG) { newTotal++; newNg++; }

                    return {
                        ...station, status: newStatus, currentModel: model, currentFrameNo: frameNo,
                        totalCount: newTotal, ngCount: newNg,
                        cycleTime: newStatus === StationStatus.RUNNING ? Math.floor(Math.random() * 15) + 15 : station.cycleTime,
                        lastUpdate: new Date().toISOString(),
                        temperature: 30 + Math.random() * 5
                    };
                }
                return station;
            });
        };

        const generateTraceabilityData = () => {
            const records = [];
            for (let i = 0; i < 50; i++) {
                const model = MODELS[Math.floor(Math.random() * MODELS.length)];
                const frameNo = `xxxxxxxxx${(1000 + i)}`;
                const stationData = {}, stationTimes = {};
                let totalTime = 0, hasFault = false;

                for (let j = 1; j <= 30; j++) {
                    const sId = `ST-${j.toString().padStart(2, '0')}`;
                    const time = Math.floor(Math.random() * 4) + 2;
                    stationTimes[sId] = time;
                    totalTime += time;
                    const rand = Math.random();
                    let status = StationStatus.OK;
                    if (rand > 0.995) { status = StationStatus.NG; hasFault = true; }
                    else if (rand > 0.99) status = StationStatus.PASS;
                    else if (rand > 0.985) status = StationStatus.OK_NG;
                    else if (rand > 0.97) status = StationStatus.SKIP;
                    stationData[sId] = status;
                }
                records.push({
                    frameNo, model,
                    startTime: new Date(Date.now() - i * 1000 * 60 * 5).toISOString(),
                    stations: stationData, stationTimes,
                    judge: hasFault ? 'NG' : 'OK', totalTime
                });
            }
            return records;
        };

        // ============ DASHBOARD COMPONENT ============
        const DashboardTV = ({ stations }) => {
            const runningCount = stations.filter(s => s.status === StationStatus.RUNNING).length;
            const ngCount = stations.filter(s => s.status === StationStatus.NG || s.status === StationStatus.PASS).length;
            const totalProduced = stations.reduce((sum, s) => sum + s.totalCount, 0);
            const targetProduced = stations.length * 25;

            const StatusCard = ({ station }) => {
                const isIdle = station.status === StationStatus.IDLE;
                const getStatusStyles = (status) => {
                    switch (status) {
                        case StationStatus.OK: return 'border-l-green-500 bg-white text-green-600';
                        case StationStatus.NG: return 'border-l-red-500 bg-red-50 text-red-600';
                        case StationStatus.RUNNING: return 'border-l-blue-500 bg-white text-blue-600';
                        default: return 'border-l-gray-300 bg-gray-50 text-gray-400';
                    }
                };

                return (
                    <div className={`p-3 rounded-lg border border-l-[6px] h-40 ${getStatusStyles(station.status)} ${isIdle ? 'opacity-60' : ''}`}>
                        <div className="flex justify-between items-start mb-1">
                            <div>
                                <h3 className="font-bold text-sm truncate">{station.name}</h3>
                                <p className="text-xs text-gray-400 font-mono">Station {station.index}</p>
                            </div>
                            <div className="text-xs font-bold px-2 py-1 rounded bg-gray-200">{station.status}</div>
                        </div>
                        {!isIdle && (
                            <>
                                <div className="rounded p-2 mb-1 bg-slate-50 border border-slate-100">
                                    <div className="flex justify-between text-xs">
                                        <span className="text-gray-500">MDL:</span>
                                        <span className="font-mono font-bold">{station.currentModel}</span>
                                    </div>
                                    <div className="flex justify-between text-xs">
                                        <span className="text-gray-500">FRM:</span>
                                        <span className="font-mono font-bold">{station.currentFrameNo}</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center text-xs">
                                    <span className="text-gray-400">Cycle</span>
                                    <span className="font-mono font-bold">{station.cycleTime}s</span>
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            return (
                <div className="h-full flex flex-col gap-4 p-6">
                    <div className="grid grid-cols-4 gap-4">
                        <div className="bg-white border p-4 rounded-xl shadow-sm">
                            <div className="text-xs font-bold text-gray-400">Active Stations</div>
                            <div className="text-3xl font-bold">{runningCount} <span className="text-sm text-gray-400">/ 30</span></div>
                        </div>
                        <div className={`border p-4 rounded-xl ${ngCount > 0 ? 'bg-red-50 border-red-200' : 'bg-white'}`}>
                            <div className="text-xs font-bold text-gray-400">Line Alarms</div>
                            <div className={`text-3xl font-bold ${ngCount > 0 ? 'text-red-600' : 'text-slate-800'}`}>{ngCount}</div>
                        </div>
                        <div className="bg-white border p-4 rounded-xl shadow-sm">
                            <div className="text-xs font-bold text-gray-400">Target / Actual</div>
                            <div className="text-2xl font-bold">{targetProduced} / <span className="text-green-600">{totalProduced}</span></div>
                        </div>
                        <div className="bg-white border p-4 rounded-xl shadow-sm">
                            <div className="text-xs font-bold text-gray-400">Est. Output / Hr</div>
                            <div className="text-3xl font-bold">--</div>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto">
                        <div className="grid grid-cols-6 gap-3">
                            {stations.map(station => <StatusCard key={station.id} station={station} />)}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ LAYOUT MAP COMPONENT (FULL VERSION) ============
        const LayoutMap = ({ stations, onStationClick }) => {
            const StationNode = ({ index, x, y, width = 25, height = 25 }) => {
                const station = stations[index - 1];
                if (!station) return null;
                const getColor = (s) => {
                    switch (s) {
                        case StationStatus.RUNNING: return '#3b82f6';
                        case StationStatus.OK: return '#22c55e';
                        case StationStatus.NG: return '#ef4444';
                        case StationStatus.PASS: return '#ef4444';
                        case StationStatus.SKIP: return '#facc15';
                        case StationStatus.IDLE: return '#FFFFE0';
                        default: return '#e2e8f0';
                    }
                };
                const color = getColor(station.status);
                const isAlarm = station.status === StationStatus.NG || station.status === StationStatus.PASS;
                return <g onClick={() => onStationClick(station)} style={{ cursor: 'pointer' }}><rect x={x} y={y} width={width} height={height} fill={color} stroke="#555" strokeWidth={isAlarm ? 3 : 2} className={isAlarm ? 'animate-pulse' : ''} /><text x={x + width / 2} y={y + height / 2 + 1} fontFamily="Arial" fontSize={isAlarm ? "14px" : "12px"} fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill={station.status === StationStatus.IDLE ? '#333' : '#FFF'}>{index}</text></g>;
            };

            return (
                <div className="h-full bg-white rounded-lg border overflow-hidden relative">
                    <div className="absolute top-4 left-4 z-10 bg-black/60 backdrop-blur px-4 py-2 rounded pointer-events-none">
                        <h2 className="text-xl font-bold text-white">Interactive Factory Layout</h2>
                        <p className="text-xs text-gray-300">Live Monitor - 30 Stations</p>
                    </div>
                    <div className="w-full h-full overflow-auto flex items-center justify-center bg-gray-100 p-4">
                        <svg width="1800" height="600" viewBox="0 0 1800 600" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <pattern id="hatch" width="4" height="4" patternUnits="userSpaceOnUse" patternTransform="rotate(45)">
                                    <rect width="2" height="4" fill="#888" opacity="0.5" />
                                </pattern>
                            </defs>

                            {/* OVERHEAD LINE SECTION */}
                            <g transform="translate(50, 50)">
                                <path d="M 350,225 L 480,225 L 480,375 L 100,375 L 100,125 L 250,125 L 250,200 L 250,225 L 350,225" fill="none" stroke="#999" strokeWidth="6" strokeLinecap="round" strokeLinejoin="round" />

                                {/* Stations 1-4 (Top horizontal) */}
                                <g transform="translate(300, 212.5)">
                                    <StationNode index={1} x={0} y={0} width={30} height={25} />
                                    <StationNode index={2} x={40} y={0} width={30} height={25} />
                                    <StationNode index={3} x={80} y={0} width={30} height={25} />
                                    <StationNode index={4} x={120} y={0} width={30} height={25} />
                                </g>

                                {/* Stations 5-7 (Right vertical) */}
                                <g transform="translate(465, 250)">
                                    <StationNode index={5} x={0} y={0} width={25} height={30} />
                                    <StationNode index={6} x={0} y={40} width={25} height={30} />
                                    <StationNode index={7} x={0} y={80} width={25} height={30} />
                                </g>

                                {/* Stations 8-15 (Bottom horizontal) */}
                                <g transform="translate(60, 362.5)">
                                    <StationNode index={8} x={360} y={0} width={30} height={25} />
                                    <StationNode index={9} x={320} y={0} width={30} height={25} />
                                    <StationNode index={10} x={280} y={0} width={30} height={25} />
                                    <StationNode index={11} x={240} y={0} width={30} height={25} />
                                    <StationNode index={12} x={200} y={0} width={30} height={25} />
                                    <StationNode index={13} x={160} y={0} width={30} height={25} />
                                    <StationNode index={14} x={120} y={0} width={30} height={25} />
                                    <StationNode index={15} x={80} y={0} width={30} height={25} />
                                </g>

                                {/* Decorative boxes - Left side */}
                                <g transform="translate(87.5, 110)">
                                    <rect x="0" y="240" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="255" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="0" y="200" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="215" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="0" y="160" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="175" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="0" y="120" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="135" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="0" y="80" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="95" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="0" y="40" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="55" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                </g>

                                {/* Middle monitor section */}
                                <g transform="translate(105, 110)">
                                    <rect x="5" y="0" width="30" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="20" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <path d="M 40,-10 A 30,25 0 0,1 100,-10" fill="#FFFACD" stroke="#888" strokeWidth="1" />
                                    <path d="M 40,35 A 30,25 0 0,0 100,35" fill="#FFFACD" stroke="#888" strokeWidth="1" />
                                    <rect x="40" y="0" width="60" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" />
                                    <text x="70" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">MD</text>
                                    <text x="70" y="-55" fontFamily="Arial" fontSize="11" textAnchor="middle" fill="black">Middle</text>
                                    <text x="70" y="-42" fontFamily="Arial" fontSize="11" textAnchor="middle" fill="black">monitor</text>
                                    <rect x="105" y="0" width="30" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="120" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="132.5" y="35" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="145" y="50" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="132.5" y="75" width="25" height="30" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="145" y="90" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                </g>

                                {/* Labels */}
                                <rect x="250" y="260" width="100" height="30" fill="blue" rx="5" />
                                <text x="300" y="275" fill="white" fontFamily="Arial" fontSize="16px" fontWeight="bold" textAnchor="middle" dominantBaseline="middle">OVER HEAD</text>
                                <rect x="400" y="280" width="50" height="40" fill="#FFE4C4" />
                                <text x="425" y="300" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">Sub</text>
                                <text x="425" y="315" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">box 1</text>
                                <rect x="150" y="300" width="50" height="40" fill="#FFE4C4" />
                                <text x="175" y="320" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">Sub</text>
                                <text x="175" y="335" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">box 2</text>
                                <rect x="10" y="210" width="50" height="40" fill="#FFE4C4" />
                                <text x="35" y="230" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">Sub</text>
                                <text x="35" y="245" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">box 3</text>
                                <path d="M 240,80 L 255,50 L 270,80 Z" fill="skyblue" />
                                <text x="270" y="70" fontFamily="Arial" fontSize="14px" fontWeight="bold">Monitor</text>
                                <circle cx="280" cy="210" r="8" fill="#DDD" /><text x="280" y="210" fontFamily="Arial" fontSize="10px" textAnchor="middle" dominantBaseline="central">L</text>
                                <circle cx="280" cy="240" r="8" fill="#DDD" /><text x="280" y="240" fontFamily="Arial" fontSize="10px" textAnchor="middle" dominantBaseline="central">R</text>
                            </g>

                            {/* MAIN LINE SECTION */}
                            <g transform="translate(190, 120)">
                                <line x1="180" y1="75" x2="1220" y2="75" stroke="#999" strokeWidth="36" strokeLinecap="round" />
                                <rect x="210" y="20" width="110" height="30" fill="blue" rx="5" />
                                <text x="265" y="35" fill="white" fontFamily="Arial" fontSize="16px" fontWeight="bold" textAnchor="middle" dominantBaseline="middle">MAIN LINE</text>
                                <circle cx="160" cy="50" r="8" fill="#DDD" /><text x="160" y="50" fontFamily="Arial" fontSize="10px" textAnchor="middle" dominantBaseline="central">L</text>
                                <circle cx="160" cy="100" r="8" fill="#DDD" /><text x="160" y="100" fontFamily="Arial" fontSize="10px" textAnchor="middle" dominantBaseline="central">R</text>
                                <rect x="180" y="65" width="60" height="20" fill="url(#hatch)" />
                                <rect x="180" y="95" width="80" height="20" fill="#DDD" stroke="black" />
                                <text x="220" y="108" fontFamily="Arial" fontSize="10px" fontWeight="bold" textAnchor="middle" fill="#333">AUTO IMPACT</text>

                                {/* Stations 16-30 */}
                                <g transform="translate(250, 62.5)">
                                    <StationNode index={16} x={0} y={0} width={25} height={25} />
                                    <StationNode index={17} x={30} y={0} width={25} height={25} />
                                    <StationNode index={18} x={60} y={0} width={25} height={25} />
                                    <StationNode index={19} x={90} y={0} width={25} height={25} />
                                    <StationNode index={20} x={120} y={0} width={25} height={25} />
                                    <StationNode index={21} x={150} y={0} width={25} height={25} />
                                    <StationNode index={22} x={180} y={0} width={25} height={25} />
                                    <StationNode index={23} x={210} y={0} width={25} height={25} />
                                    <StationNode index={24} x={240} y={0} width={25} height={25} />
                                    <StationNode index={25} x={270} y={0} width={25} height={25} />
                                    <StationNode index={26} x={300} y={0} width={25} height={25} />
                                    <StationNode index={27} x={330} y={0} width={25} height={25} />
                                    <StationNode index={28} x={360} y={0} width={25} height={25} />
                                    <StationNode index={29} x={390} y={0} width={25} height={25} />
                                    <StationNode index={30} x={420} y={0} width={25} height={25} />
                                </g>

                                {/* Middle monitor 1 */}
                                <g transform="translate(710, 62.5)">
                                    <path d="M 0,-10 A 30,30 0 0,1 60,-10" fill="#FFFACD" stroke="#888" strokeWidth="1" />
                                    <text x="30" y="-60" fontFamily="Arial" fontSize="12px" textAnchor="middle" fill="black">Middle</text>
                                    <text x="30" y="-45" fontFamily="Arial" fontSize="12px" textAnchor="middle" fill="black">monitor</text>
                                    <path d="M 0,35 A 30,30 0 0,0 60,35" fill="#FFFACD" stroke="#888" strokeWidth="1" />
                                    <rect x="0" y="0" width="60" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="30" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">MD</text>
                                </g>

                                {/* Static boxes after monitor 1 */}
                                <g transform="translate(780, 62.5)">
                                    <rect x="0" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="30" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="42.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">DS</text>
                                    <rect x="60" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="72.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="90" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="102.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="120" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="132.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="150" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="162.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="180" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="192.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="210" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="222.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="240" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="252.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                </g>

                                {/* Middle monitor 2 */}
                                <g transform="translate(1060, 62.5)">
                                    <path d="M 0,-10 A 30,30 0 0,1 60,-10" fill="#FFFACD" stroke="#888" strokeWidth="1" />
                                    <text x="30" y="-60" fontFamily="Arial" fontSize="12px" textAnchor="middle" fill="black">Middle</text>
                                    <text x="30" y="-45" fontFamily="Arial" fontSize="12px" textAnchor="middle" fill="black">monitor</text>
                                    <path d="M 0,35 A 30,30 0 0,0 60,35" fill="#FFFACD" stroke="#888" strokeWidth="1" />
                                    <rect x="0" y="0" width="60" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="30" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">MD</text>
                                </g>

                                {/* End section */}
                                <g transform="translate(1130, 62.5)">
                                    <rect x="0" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="12.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="30" y="0" width="25" height="25" fill="#FFFFE0" stroke="#555" strokeWidth="2" /><text x="42.5" y="12.5" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" dominantBaseline="central" fill="#333">-</text>
                                    <rect x="40" y="35" width="60" height="20" fill="url(#hatch)" />
                                    <rect x="20" y="60" width="80" height="20" fill="#DDD" stroke="black" />
                                    <text x="60" y="73" fontFamily="Arial" fontSize="10px" fontWeight="bold" textAnchor="middle" fill="#333">AUTO IMPACT</text>
                                </g>

                                {/* Sub boxes */}
                                <g transform="translate(250, -10)">
                                    <rect x="210" y="20" width="50" height="40" fill="#FFE4C4" /><text x="235" y="40" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">Sub</text><text x="235" y="55" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">box 4</text>
                                    <rect x="390" y="20" width="50" height="40" fill="#FFE4C4" /><text x="415" y="40" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">Sub</text><text x="415" y="55" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">box 5</text>
                                    <rect x="580" y="20" width="50" height="40" fill="#FFE4C4" /><text x="605" y="40" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">Sub</text><text x="605" y="55" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">box 6</text>
                                    <rect x="730" y="20" width="50" height="40" fill="#FFE4C4" /><text x="755" y="40" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">Sub</text><text x="755" y="55" fontFamily="Arial" fontSize="14px" fontWeight="bold" textAnchor="middle" fill="black">box 7</text>
                                </g>

                                {/* Control arrow */}
                                <g transform="translate(1100, 180)">
                                    <path d="M 0,20 L 15,-10 L 30,20 Z" fill="#EE82EE" />
                                    <text x="40" y="10" fontFamily="Arial" fontSize="14px" fontWeight="bold">Main control</text>
                                </g>
                            </g>
                        </svg>
                    </div>

                    {/* Legend */}
                    <div className="absolute bottom-4 left-4 z-10">
                        <div className="bg-white/80 backdrop-blur border border-gray-300 p-2 rounded shadow flex items-center gap-4 text-xs">
                            <span className="font-bold text-gray-700">LEGEND:</span>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-blue-500"></div><span>Running</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-500"></div><span>OK</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-red-500"></div><span>NG/Alarm</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-400"></div><span>Skip</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-100 border border-gray-400"></div><span>Idle</span></div>
                        </div>
                    </div>
                    <div className="absolute bottom-4 right-4 bg-black/50 p-2 rounded text-sm text-gray-200">
                        * Click on station circles to view HMI
                    </div>
                </div>
            );
        };

        // ============ REPORT DATA COMPONENT (2-ROW FORMAT) ============
        const ReportData = ({ stations }) => {
            const [data] = useState(generateTraceabilityData());
            const [selectedModel, setSelectedModel] = useState('All');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [currentPage, setCurrentPage] = useState(1);
            const [rowsPerPage, setRowsPerPage] = useState(10);

            const filteredData = useMemo(() => {
                return data.filter(record => {
                    const matchModel = selectedModel === 'All' || record.model === selectedModel;
                    const recordDate = new Date(record.startTime).toISOString().split('T')[0];
                    const matchDate = !selectedDate || recordDate === selectedDate;
                    return matchModel && matchDate;
                });
            }, [data, selectedModel, selectedDate]);

            const paginatedData = useMemo(() => {
                const start = (currentPage - 1) * rowsPerPage;
                return filteredData.slice(start, start + rowsPerPage);
            }, [filteredData, currentPage, rowsPerPage]);

            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            const stationColumns = Array.from({ length: 20 }, (_, i) => i + 1);

            const getStatusDisplay = (status) => {
                if (!status) return { content: '-', className: 'text-gray-600' };
                switch (status) {
                    case StationStatus.OK: return { content: 'OK', className: 'bg-green-600 text-white font-bold' };
                    case StationStatus.NG: return { content: 'NG', className: 'bg-red-600 text-white font-bold' };
                    case StationStatus.PASS: return { content: 'Pass', className: 'bg-red-600 text-white font-bold' };
                    case StationStatus.SKIP: return { content: 'Skip', className: 'bg-yellow-400 text-black font-bold' };
                    case StationStatus.OK_NG: return { content: React.createElement('div', { className: 'flex flex-col items-center justify-center leading-none' }, React.createElement('span', { className: 'mb-[1px]' }, 'OK'), React.createElement('span', { className: 'text-[0.8em]' }, '(NG)')), className: 'bg-yellow-600 text-white font-bold text-xs' };
                    default: return { content: status, className: 'text-gray-400' };
                }
            };

            const handleExport = () => {
                if (filteredData.length === 0) { alert("No data to export"); return; }
                const headers = ["FRAME NO", "MODEL", "START TIME", ...stationColumns.map(n => `ST-${n} STATUS`), "JUDGE", ...stationColumns.map(n => `ST-${n} TIME(s)`), "TOTAL TIME(s)"];
                const rows = filteredData.map(record => {
                    const stStatuses = stationColumns.map(n => record.stations[`ST-${n.toString().padStart(2, '0')}`] || '-');
                    const stTimes = stationColumns.map(n => record.stationTimes[`ST-${n.toString().padStart(2, '0')}`] || 0);
                    return [record.frameNo, record.model, `"${new Date(record.startTime).toLocaleString()}"`, ...stStatuses, record.judge, ...stTimes, record.totalTime].join(",");
                });
                const csvContent = [headers.join(","), ...rows].join("\n");
                const blob = new Blob(["\uFEFF" + csvContent], { type: "text/csv;charset=utf-8;" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url; link.download = `Production_Log_${selectedDate || 'all'}.csv`;
                document.body.appendChild(link); link.click(); document.body.removeChild(link);
            };

            return (
                <div className="h-full flex flex-col gap-4 p-6">
                    <div className="bg-white p-4 rounded-lg border flex flex-wrap gap-4 justify-between items-center">
                        <div>
                            <h2 className="font-bold text-lg text-slate-900">Traceability Log</h2>
                            <p className="text-[0.75em] text-gray-500">Production History (2-Row View: Status + Time)</p>
                        </div>
                        <div className="flex flex-wrap items-center gap-4 flex-1 justify-end text-[0.85em]">
                            <div className="flex items-center gap-2 bg-gray-50 px-3 py-2 rounded border">
                                <span className="text-gray-500 text-xs">Model:</span>
                                <select value={selectedModel} onChange={(e) => setSelectedModel(e.target.value)} className="bg-transparent border-none focus:outline-none text-sm cursor-pointer">
                                    <option value="All">All Models</option>
                                    <option value="K2JL">K2JL</option>
                                    <option value="K3FG">K3FG</option>
                                    <option value="K1M">K1M</option>
                                </select>
                            </div>
                            <div className="flex items-center gap-2 bg-gray-50 px-3 py-2 rounded border">
                                <input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} className="bg-transparent border-none focus:outline-none text-sm cursor-pointer" />
                            </div>
                            <button onClick={handleExport} className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded text-sm transition-colors shadow-lg">üì• Export</button>
                        </div>
                    </div>
                    <div className="flex-1 bg-white rounded-lg border overflow-hidden flex flex-col relative">
                        <div className="overflow-auto h-full">
                            <table className="w-full text-center text-sm border-collapse min-w-[1400px]">
                                <thead className="bg-gray-50 text-gray-500 font-bold text-[0.8em] sticky top-0 z-40 shadow-md">
                                    <tr>
                                        <th rowSpan="2" className="p-3 border-b border-r border-gray-300 text-center sticky left-0 bg-gray-50 z-50 w-[75px] min-w-[75px] max-w-[75px] text-gray-600 shadow-[2px_0_5px_rgba(0,0,0,0.1)]">FRAME NO.</th>
                                        <th colSpan="20" className="p-2 border-b border-gray-300 border-l border-gray-300 text-gray-600">Station</th>
                                        <th rowSpan="2" className="p-1 border-b border-l border-gray-300 w-[60px] min-w-[60px] sticky right-0 bg-gray-50 z-50 text-gray-600 shadow-[-2px_0_5px_rgba(0,0,0,0.1)]">JUDGE<br /><span className="text-[0.8em] text-gray-400 font-normal">TIME</span></th>
                                    </tr>
                                    <tr>
                                        {stationColumns.map(num => <th key={num} className="p-1 border-b border-gray-300 w-7 min-w-[26px] border-l border-gray-300 text-gray-500 text-[0.9em]">{num}</th>)}
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {paginatedData.length === 0 ? (
                                        <tr><td colSpan="22" className="p-10 text-gray-500">No data found for the selected model/date.</td></tr>
                                    ) : (
                                        paginatedData.map((row, idx) => {
                                            const isEven = idx % 2 === 0;
                                            const rowBgClass = isEven ? 'bg-slate-50' : 'bg-white';
                                            return (
                                                React.createElement(React.Fragment, { key: idx },
                                                    React.createElement('tr', { className: `${rowBgClass} transition-colors hover:bg-blue-50 group` },
                                                        React.createElement('td', { className: `p-1 text-left font-mono font-bold text-blue-600 sticky left-0 border-r border-gray-200 z-30 align-middle shadow-[2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[75px] min-w-[75px] max-w-[75px]` },
                                                            React.createElement('div', { className: 'text-[1.1em] break-all leading-tight' }, row.frameNo),
                                                            React.createElement('div', { className: 'text-[0.8em] text-gray-400 font-normal mt-0.5 truncate' }, row.model)
                                                        ),
                                                        stationColumns.map(num => {
                                                            const stId = `ST-${num.toString().padStart(2, '0')}`;
                                                            const status = row.stations[stId];
                                                            const { content, className } = getStatusDisplay(status);
                                                            return React.createElement('td', { key: `st-${stId}`, className: 'p-[2px] border-l border-gray-200 align-middle' },
                                                                React.createElement('div', { className: `w-full h-8 flex items-center justify-center rounded ${className} text-[0.8em]` }, content)
                                                            );
                                                        }),
                                                        React.createElement('td', { className: `p-1 sticky right-0 z-30 border-l border-gray-200 font-bold align-middle shadow-[-2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[60px] min-w-[60px]` },
                                                            React.createElement('div', { className: `mx-auto px-1 py-1 rounded w-full h-6 flex items-center justify-center text-[0.9em] ${row.judge === 'NG' ? 'bg-red-100 text-red-600 border border-red-200' : 'text-green-600'}` }, row.judge)
                                                        )
                                                    ),
                                                    React.createElement('tr', { className: `${rowBgClass} border-b border-gray-200 group` },
                                                        React.createElement('td', { className: `p-1 text-right text-[0.8em] text-gray-400 sticky left-0 border-r border-gray-200 z-30 font-mono shadow-[2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[75px] min-w-[75px] max-w-[75px]` }, 'T(s)'),
                                                        stationColumns.map(num => {
                                                            const stId = `ST-${num.toString().padStart(2, '0')}`;
                                                            const time = row.stationTimes[stId];
                                                            return React.createElement('td', { key: `time-${stId}`, className: 'p-[2px] border-l border-gray-200 text-[0.8em] text-gray-500 font-mono' }, time);
                                                        }),
                                                        React.createElement('td', { className: `p-1 sticky right-0 z-30 border-l border-gray-200 align-middle text-right font-mono text-[0.9em] text-slate-800 shadow-[-2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[60px] min-w-[60px]` },
                                                            React.createElement('div', { className: 'pr-1' }, `${row.totalTime}s`)
                                                        )
                                                    )
                                                )
                                            );
                                        })
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div className="flex flex-wrap justify-between items-center bg-white p-3 rounded-lg border text-[0.8em]">
                        <div className="flex items-center gap-3 text-gray-500">
                            <span>Show</span>
                            <select value={rowsPerPage} onChange={(e) => { setRowsPerPage(Number(e.target.value)); setCurrentPage(1); }} className="bg-gray-50 border border-gray-300 rounded px-2 py-1 focus:outline-none text-slate-800">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            <span>rows / page</span>
                            <span className="border-l border-gray-300 pl-3">Total {filteredData.length} records</span>
                        </div>
                        <div className="flex items-center gap-1">
                            <button onClick={() => setCurrentPage(1)} disabled={currentPage === 1} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚èÆ</button>
                            <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚óÄ</button>
                            <span className="text-slate-800 font-mono bg-gray-50 px-2 py-1 rounded border border-gray-300 min-w-[30px] text-center">{currentPage}</span>
                            <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚ñ∂</button>
                            <button onClick={() => setCurrentPage(totalPages)} disabled={currentPage === totalPages} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚è≠</button>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ STATION HMI COMPONENT ============
        const StationHMI = ({ station, onBack }) => {
            if (!station) return <div className="text-white p-10">Station not found</div>;
            const getStatusColor = (status) => {
                switch (status) {
                    case StationStatus.OK: return 'bg-green-500';
                    case StationStatus.NG: return 'bg-red-600';
                    case StationStatus.RUNNING: return 'bg-blue-600';
                    default: return 'bg-gray-600';
                }
            };

            return (
                <div className="fixed inset-0 bg-black text-white flex flex-col z-50">
                    <div className="h-16 bg-gray-900 flex items-center justify-between px-6 border-b border-gray-700">
                        <button onClick={onBack} className="bg-gray-700 hover:bg-gray-600 p-2 rounded font-bold">‚Üê BACK</button>
                        <div className="text-2xl font-bold">{station.name}</div>
                        <div className="text-gray-400 text-sm">{new Date().toLocaleTimeString()}</div>
                    </div>
                    <div className="flex-1 flex p-4 gap-4">
                        <div className="w-1/2">
                            <div className={`h-full rounded-xl flex items-center justify-center ${getStatusColor(station.status)}`}>
                                <div className="text-center">
                                    <div className="text-8xl font-black uppercase">{station.status}</div>
                                    <div className="text-2xl mt-4 opacity-80">Current State</div>
                                </div>
                            </div>
                        </div>
                        <div className="w-1/2 bg-gray-900 rounded-xl p-6 flex flex-col justify-center">
                            <div className="flex justify-between border-b border-gray-600 pb-4 mb-4">
                                <span className="text-gray-400 text-xl">Model</span>
                                <span className="text-3xl font-mono font-bold text-blue-400">{station.currentModel}</span>
                            </div>
                            <div className="flex justify-between border-b border-gray-600 pb-4 mb-4">
                                <span className="text-gray-400 text-xl">Cycle Time</span>
                                <div><span className="text-6xl font-mono font-bold">{station.cycleTime.toFixed(1)}</span><span className="text-gray-500 ml-2">sec</span></div>
                            </div>
                            <div className="flex justify-between border-b border-gray-600 pb-4 mb-4">
                                <span className="text-gray-400 text-xl">Total Output</span>
                                <span className="text-6xl font-mono font-bold">{station.totalCount}</span>
                            </div>
                            <div className="flex justify-between">
                                <span className="text-gray-400 text-xl">NG Count</span>
                                <span className="text-6xl font-mono font-bold text-red-500">{station.ngCount}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ MAIN APP ============
        const App = () => {
            const [stations, setStations] = useState(generateInitialStations());
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [selectedStation, setSelectedStation] = useState(null);

            useEffect(() => {
                const interval = setInterval(() => {
                    setStations(prev => simulateLiveUpdate(prev));
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            const renderPage = () => {
                if (selectedStation) {
                    return <StationHMI station={selectedStation} onBack={() => setSelectedStation(null)} />;
                }
                switch (currentPage) {
                    case 'dashboard': return <DashboardTV stations={stations} />;
                    case 'layout': return <LayoutMap stations={stations} onStationClick={setSelectedStation} />;
                    case 'report': return <ReportData stations={stations} />;
                    default: return <DashboardTV stations={stations} />;
                }
            };

            if (selectedStation) return renderPage();

            return (
                <div className="flex h-screen">
                    <aside className="w-64 bg-white border-r flex flex-col">
                        <div className="h-16 flex items-center px-4 border-b">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Honda_Logo.svg/2552px-Honda_Logo.svg.png" alt="Honda" className="w-10 h-10 mr-2" />
                            <span className="font-bold text-lg">SMART LINE</span>
                        </div>
                        <nav className="flex-1 p-3">
                            <button onClick={() => setCurrentPage('dashboard')} className={`w-full text-left p-3 rounded mb-2 ${currentPage === 'dashboard' ? 'bg-blue-50 text-blue-600 font-bold' : 'hover:bg-gray-100'}`}>üì∫ TV Dashboard</button>
                            <button onClick={() => setCurrentPage('layout')} className={`w-full text-left p-3 rounded mb-2 ${currentPage === 'layout' ? 'bg-blue-50 text-blue-600 font-bold' : 'hover:bg-gray-100'}`}>üó∫Ô∏è Factory Layout</button>
                            <button onClick={() => setCurrentPage('report')} className={`w-full text-left p-3 rounded mb-2 ${currentPage === 'report' ? 'bg-blue-50 text-blue-600 font-bold' : 'hover:bg-gray-100'}`}>üìÑ Production Report</button>
                        </nav>
                        <div className="p-4 border-t">
                            <div className="flex items-center gap-2">
                                <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                                <span className="text-xs text-gray-500">System Online</span>
                            </div>
                        </div>
                    </aside>
                    <main className="flex-1 flex flex-col overflow-hidden">
                        <header className="h-16 bg-white border-b flex items-center justify-between px-6">
                            <h1 className="text-xl font-bold">
                                {currentPage === 'dashboard' && 'Main Production Overview'}
                                {currentPage === 'layout' && 'Interactive Factory Layout'}
                                {currentPage === 'report' && 'Production Data Logs'}
                            </h1>
                            <div className="text-right">
                                <div className="text-sm font-bold">{new Date().toLocaleTimeString()}</div>
                                <div className="text-xs text-gray-500">{new Date().toLocaleDateString()}</div>
                            </div>
                        </header>
                        <div className="flex-1 overflow-hidden">
                            {renderPage()}
                        </div>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>