<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Honda SMART LINE - Production Monitor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="factory-layout.js"></script>
    <style>
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .custom-scrollbar {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 #f1f5f9;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ============ TYPES & DATA ============
        const StationStatus = {
            IDLE: 'IDLE', RUNNING: 'RUNNING', OK: 'OK', NG: 'NG',
            OFFLINE: 'OFFLINE', OK_NG: 'OK (NG)', PASS: 'PASS', SKIP: 'SKIP'
        };

        const MODELS = ['K2JL', 'K3FG', 'K1M'];

        const generateInitialStations = () => {
            return Array.from({ length: 45 }, (_, i) => ({
                id: `ST-${(i + 1).toString().padStart(2, '0')}`,
                index: i + 1,
                name: `OP-${(i + 1) * 10}`,
                status: StationStatus.IDLE,
                cycleTime: 0,
                totalCount: 0,
                ngCount: 0,
                lastUpdate: new Date().toISOString(),
                currentModel: '-',
                currentFrameNo: '-',
                temperature: 30
            }));
        };

        const simulateLiveUpdate = (stations) => {
            return stations.map(station => {
                if (Math.random() > 0.8) {
                    const isActive = Math.random() > 0.4;
                    if (!isActive) return { ...station, status: StationStatus.IDLE };

                    const model = MODELS[Math.floor(Math.random() * MODELS.length)];
                    const frameNo = `FR-${Math.floor(Math.random() * 10000)}`;
                    const rand = Math.random();
                    let newStatus = StationStatus.RUNNING;

                    if (rand > 0.95) newStatus = StationStatus.NG;
                    else if (rand > 0.90) newStatus = StationStatus.OK;
                    else if (rand > 0.88) newStatus = StationStatus.SKIP;
                    else if (rand > 0.3) newStatus = StationStatus.RUNNING;
                    else newStatus = StationStatus.OK;

                    let newTotal = station.totalCount;
                    let newNg = station.ngCount;
                    if (newStatus === StationStatus.OK || newStatus === StationStatus.SKIP) newTotal++;
                    if (newStatus === StationStatus.NG) { newTotal++; newNg++; }

                    return {
                        ...station, status: newStatus, currentModel: model, currentFrameNo: frameNo,
                        totalCount: newTotal, ngCount: newNg,
                        cycleTime: newStatus === StationStatus.RUNNING ? Math.floor(Math.random() * 15) + 15 : station.cycleTime,
                        lastUpdate: new Date().toISOString(),
                        temperature: 30 + Math.random() * 5
                    };
                }
                return station;
            });
        };

        const generateTraceabilityData = () => {
            const records = [];
            for (let i = 0; i < 50; i++) {
                const model = MODELS[Math.floor(Math.random() * MODELS.length)];
                const frameNo = `xxxxxxxxx${(1000 + i)}`;
                const stationData = {}, stationTimes = {};
                let totalTime = 0, hasFault = false;

                for (let j = 1; j <= 45; j++) {
                    const sId = `ST-${j.toString().padStart(2, '0')}`;
                    const time = Math.floor(Math.random() * 4) + 2;
                    stationTimes[sId] = time;
                    totalTime += time;
                    const rand = Math.random();
                    let status = StationStatus.OK;
                    if (rand > 0.995) { status = StationStatus.NG; hasFault = true; }
                    else if (rand > 0.99) status = StationStatus.PASS;
                    else if (rand > 0.985) status = StationStatus.OK_NG;
                    else if (rand > 0.97) status = StationStatus.SKIP;
                    stationData[sId] = status;
                }
                records.push({
                    frameNo, model,
                    startTime: new Date(Date.now() - i * 1000 * 60 * 5).toISOString(),
                    stations: stationData, stationTimes,
                    judge: hasFault ? 'NG' : 'OK', totalTime
                });
            }
            return records;
        };

        // ============ DASHBOARD COMPONENT ============
        const DashboardTV = ({ stations }) => {
            const runningCount = stations.filter(s => s.status === StationStatus.RUNNING).length;
            const ngCount = stations.filter(s => s.status === StationStatus.NG || s.status === StationStatus.PASS).length;
            const totalProduced = stations.reduce((sum, s) => sum + s.totalCount, 0);
            const targetProduced = stations.length * 25;

            const StatusCard = ({ station }) => {
                const isIdle = station.status === StationStatus.IDLE;
                const getStatusStyles = (status) => {
                    switch (status) {
                        case StationStatus.OK: return 'border-l-green-500 bg-white text-green-600';
                        case StationStatus.NG: return 'border-l-red-500 bg-red-50 text-red-600';
                        case StationStatus.RUNNING: return 'border-l-blue-500 bg-white text-blue-600';
                        default: return 'border-l-gray-300 bg-gray-50 text-gray-400';
                    }
                };

                return (
                    <div className={`p-3 rounded-lg border border-l-[6px] h-40 ${getStatusStyles(station.status)} ${isIdle ? 'opacity-60' : ''}`}>
                        <div className="flex justify-between items-start mb-1">
                            <div>
                                <h3 className="font-bold text-sm truncate">{station.name}</h3>
                                <p className="text-xs text-gray-400 font-mono">Station {station.index}</p>
                            </div>
                            <div className="text-xs font-bold px-2 py-1 rounded bg-gray-200">{station.status}</div>
                        </div>
                        {!isIdle && (
                            <>
                                <div className="rounded p-2 mb-1 bg-slate-50 border border-slate-100">
                                    <div className="flex justify-between text-xs">
                                        <span className="text-gray-500">MDL:</span>
                                        <span className="font-mono font-bold">{station.currentModel}</span>
                                    </div>
                                    <div className="flex justify-between text-xs">
                                        <span className="text-gray-500">FRM:</span>
                                        <span className="font-mono font-bold">{station.currentFrameNo}</span>
                                    </div>
                                </div>
                                <div className="flex justify-between items-center text-xs">
                                    <span className="text-gray-400">Cycle</span>
                                    <span className="font-mono font-bold">{station.cycleTime}s</span>
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            return (
                <div className="h-full flex flex-col gap-4 p-6">
                    <div className="grid grid-cols-4 gap-4">
                        <div className="bg-white border p-4 rounded-xl shadow-sm">
                            <div className="text-xs font-bold text-gray-400">Current Status</div>
                            <div className="text-3xl font-bold">{runningCount} <span className="text-sm text-gray-400">/ 30</span></div>
                        </div>
                        <div className={`border p-4 rounded-xl ${ngCount > 0 ? 'bg-red-50 border-red-200' : 'bg-white'}`}>
                            <div className="text-xs font-bold text-gray-400">Line NG</div>
                            <div className={`text-3xl font-bold ${ngCount > 0 ? 'text-red-600' : 'text-slate-800'}`}>{ngCount}</div>
                        </div>
                        <div className="bg-white border p-4 rounded-xl shadow-sm">
                            <div className="text-xs font-bold text-gray-400">Target / Actual</div>
                            <div className="text-2xl font-bold">{targetProduced} / <span className="text-green-600">{totalProduced}</span></div>
                        </div>
                        <div className="bg-white border p-4 rounded-xl shadow-sm">
                            <div className="text-xs font-bold text-gray-400">Est. Output / Hr</div>
                            <div className="text-3xl font-bold">--</div>
                        </div>
                    </div>
                    <div className="flex-1 overflow-y-auto">
                        <div className="grid grid-cols-6 gap-3">
                            {stations.map(station => <StatusCard key={station.id} station={station} />)}
                        </div>
                    </div>
                </div>
            );
        };

        // ============ LAYOUT MAP COMPONENT (DYNAMIC SVG) ============
        // ============ LAYOUT MAP COMPONENT (DYNAMIC SVG) ============
        const LayoutMap = ({ stations, onStationClick }) => {
            const [svgContent, setSvgContent] = useState(null);
            const containerRef = React.useRef(null);

            // Load SVG from global variable (loaded via script tag)
            useEffect(() => {
                if (typeof FACTORY_LAYOUT_SVG !== 'undefined') {
                    setSvgContent(FACTORY_LAYOUT_SVG);
                } else {
                    console.error("FACTORY_LAYOUT_SVG is not defined. Ensure factory-layout.js is loaded.");
                }
            }, []);

            // Update SVG colors and interactivity when stations data changes
            useEffect(() => {
                if (!stations || !svgContent || !containerRef.current) return;

                const stationTexts = containerRef.current.querySelectorAll('.station-text');
                stationTexts.forEach(textNode => {
                    const idText = textNode.textContent.trim();
                    const stationIndex = parseInt(idText);

                    if (!isNaN(stationIndex)) {
                        const station = stations.find(s => s.index === stationIndex);
                        const rectBox = textNode.previousElementSibling;

                        // Verify structure: rect.station-box is exactly before text.station-text
                        if (station && rectBox && rectBox.classList.contains('station-box')) {
                            // Determine status color
                            let color = '#e2e8f0';
                            switch (station.status) {
                                case StationStatus.RUNNING: color = '#3b82f6'; break; // Blue
                                case StationStatus.OK: color = '#22c55e'; break;      // Green
                                case StationStatus.NG: color = '#ef4444'; break;      // Red
                                case StationStatus.PASS: color = '#ef4444'; break;    // Red
                                case StationStatus.SKIP: color = '#facc15'; break;    // Yellow
                                case StationStatus.IDLE: color = '#FFFFE0'; break;    // Pale Yellow
                                default: color = '#e2e8f0';
                            }
                            rectBox.style.fill = color;

                            // Apply Pulse Animation for Alarm (NG/PASS)
                            // We use Tailwind's 'animate-pulse' if available, otherwise fallback
                            if (station.status === StationStatus.NG || station.status === StationStatus.PASS) {
                                rectBox.classList.add('animate-pulse');
                                rectBox.style.strokeWidth = '3px';
                            } else {
                                rectBox.classList.remove('animate-pulse');
                                rectBox.style.strokeWidth = '2px';
                            }

                            // Add pointer cursor to indicate clickability
                            rectBox.style.cursor = 'pointer';
                            textNode.style.cursor = 'pointer';
                        }
                    }
                });
            }, [stations, svgContent]);

            // Handle Click via Event Delegation
            const handleSvgClick = (e) => {
                const target = e.target;
                let stationIndex = null;

                // 1. Click on Text
                if (target.classList.contains('station-text')) {
                    stationIndex = parseInt(target.textContent.trim());
                }
                // 2. Click on Rect Box (find next sibling text)
                else if (target.classList.contains('station-box')) {
                    const nextNode = target.nextElementSibling;
                    if (nextNode && nextNode.classList.contains('station-text')) {
                        stationIndex = parseInt(nextNode.textContent.trim());
                    }
                }

                if (stationIndex !== null && !isNaN(stationIndex)) {
                    const station = stations.find(s => s.index === stationIndex);
                    if (station) onStationClick(station);
                }
            };

            return (
                // Removed outer padding to maximize width
                <div className="h-full bg-white rounded-lg border overflow-hidden relative">
                    <div className="absolute top-4 left-4 z-10 bg-black/60 backdrop-blur px-4 py-2 rounded pointer-events-none">
                        <h2 className="text-xl font-bold text-white">Interactive Factory Layout</h2>
                        <p className="text-xs text-gray-300">Live Monitor - {stations.length} Stations</p>
                    </div>

                    {/* Adjusted padding to be minimal (p-2) to allow full width usage */}
                    <div className="w-full h-full overflow-auto flex items-center justify-center bg-gray-100 p-2">
                        {svgContent ? (
                            <div
                                className="w-full h-full flex items-center justify-center"
                                ref={containerRef}
                                dangerouslySetInnerHTML={{ __html: svgContent }}
                                onClick={handleSvgClick}
                            />
                        ) : (
                            <div className="flex flex-col items-center justify-center h-full text-gray-400 font-mono">
                                <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mb-4"></div>
                                <p className="text-lg">Loading Factory Layout...</p>
                                <p className="text-xs mt-2 text-orange-400">Ensure 'factory-layout.js' is in the same directory.</p>
                            </div>
                        )}
                    </div>

                    {/* Legend */}
                    <div className="absolute bottom-4 left-4 z-10">
                        <div className="bg-white/80 backdrop-blur border border-gray-300 p-2 rounded shadow flex items-center gap-4 text-xs">
                            <span className="font-bold text-gray-700">LEGEND:</span>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-blue-500"></div><span>Running</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-green-500"></div><span>OK</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-red-500"></div><span>NG/Alarm</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-400"></div><span>Skip</span></div>
                            <div className="flex items-center gap-1"><div className="w-3 h-3 bg-yellow-100 border border-gray-400"></div><span>Idle</span></div>
                        </div>
                    </div>
                    <div className="absolute bottom-4 right-4 bg-black/50 p-2 rounded text-sm text-gray-200">
                        * Click on station circles to view HMI
                    </div>
                </div>
            );
        };

        // ============ REPORT DATA COMPONENT (2-ROW FORMAT) ============
        const ReportData = ({ stations }) => {
            const [data] = useState(generateTraceabilityData());
            const [selectedModel, setSelectedModel] = useState('All');
            const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);
            const [currentPage, setCurrentPage] = useState(1);
            const [rowsPerPage, setRowsPerPage] = useState(10);

            const filteredData = useMemo(() => {
                return data.filter(record => {
                    const matchModel = selectedModel === 'All' || record.model === selectedModel;
                    const recordDate = new Date(record.startTime).toISOString().split('T')[0];
                    const matchDate = !selectedDate || recordDate === selectedDate;
                    return matchModel && matchDate;
                });
            }, [data, selectedModel, selectedDate]);

            const paginatedData = useMemo(() => {
                const start = (currentPage - 1) * rowsPerPage;
                return filteredData.slice(start, start + rowsPerPage);
            }, [filteredData, currentPage, rowsPerPage]);

            const totalPages = Math.ceil(filteredData.length / rowsPerPage);
            const stationColumns = Array.from({ length: 20 }, (_, i) => i + 1);

            const getStatusDisplay = (status) => {
                if (!status) return { content: '-', className: 'text-gray-600' };
                switch (status) {
                    case StationStatus.OK: return { content: 'OK', className: 'bg-green-600 text-white font-bold' };
                    case StationStatus.NG: return { content: 'NG', className: 'bg-red-600 text-white font-bold' };
                    case StationStatus.PASS: return { content: 'Pass', className: 'bg-red-600 text-white font-bold' };
                    case StationStatus.SKIP: return { content: 'Skip', className: 'bg-yellow-400 text-black font-bold' };
                    case StationStatus.OK_NG: return { content: React.createElement('div', { className: 'flex flex-col items-center justify-center leading-none' }, React.createElement('span', { className: 'mb-[1px]' }, 'OK'), React.createElement('span', { className: 'text-[0.8em]' }, '(NG)')), className: 'bg-yellow-600 text-white font-bold text-xs' };
                    default: return { content: status, className: 'text-gray-400' };
                }
            };

            const handleExport = () => {
                if (filteredData.length === 0) { alert("No data to export"); return; }
                const headers = ["FRAME NO", "MODEL", "START TIME", ...stationColumns.map(n => `ST-${n} STATUS`), "JUDGE", ...stationColumns.map(n => `ST-${n} TIME(s)`), "TOTAL TIME(s)"];
                const rows = filteredData.map(record => {
                    const stStatuses = stationColumns.map(n => record.stations[`ST-${n.toString().padStart(2, '0')}`] || '-');
                    const stTimes = stationColumns.map(n => record.stationTimes[`ST-${n.toString().padStart(2, '0')}`] || 0);
                    return [record.frameNo, record.model, `"${new Date(record.startTime).toLocaleString()}"`, ...stStatuses, record.judge, ...stTimes, record.totalTime].join(",");
                });
                const csvContent = [headers.join(","), ...rows].join("\n");
                const blob = new Blob(["\uFEFF" + csvContent], { type: "text/csv;charset=utf-8;" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.href = url; link.download = `Production_Log_${selectedDate || 'all'}.csv`;
                document.body.appendChild(link); link.click(); document.body.removeChild(link);
            };

            return (
                <div className="h-full flex flex-col gap-4 p-6">
                    <div className="bg-white p-4 rounded-lg border flex flex-wrap gap-4 justify-between items-center">
                        <div>
                            <h2 className="font-bold text-lg text-slate-900">Traceability Log</h2>
                            <p className="text-[0.75em] text-gray-500">Production History (2-Row View: Status + Time)</p>
                        </div>
                        <div className="flex flex-wrap items-center gap-4 flex-1 justify-end text-[0.85em]">
                            <div className="flex items-center gap-2 bg-gray-50 px-3 py-2 rounded border">
                                <span className="text-gray-500 text-xs">Model:</span>
                                <select value={selectedModel} onChange={(e) => setSelectedModel(e.target.value)} className="bg-transparent border-none focus:outline-none text-sm cursor-pointer">
                                    <option value="All">All Models</option>
                                    <option value="K2JL">K2JL</option>
                                    <option value="K3FG">K3FG</option>
                                    <option value="K1M">K1M</option>
                                </select>
                            </div>
                            <div className="flex items-center gap-2 bg-gray-50 px-3 py-2 rounded border">
                                <input type="date" value={selectedDate} onChange={(e) => setSelectedDate(e.target.value)} className="bg-transparent border-none focus:outline-none text-sm cursor-pointer" />
                            </div>
                            <button onClick={handleExport} className="flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded text-sm transition-colors shadow-lg">üì• Export</button>
                        </div>
                    </div>
                    <div className="flex-1 bg-white rounded-lg border overflow-hidden flex flex-col relative">
                        <div className="overflow-auto h-full">
                            <table className="w-full text-center text-sm border-collapse min-w-[1400px]">
                                <thead className="bg-gray-50 text-gray-500 font-bold text-[0.8em] sticky top-0 z-40 shadow-md">
                                    <tr>
                                        <th rowSpan="2" className="p-3 border-b border-r border-gray-300 text-center sticky left-0 bg-gray-50 z-50 w-[75px] min-w-[75px] max-w-[75px] text-gray-600 shadow-[2px_0_5px_rgba(0,0,0,0.1)]">FRAME NO.</th>
                                        <th colSpan="20" className="p-2 border-b border-gray-300 border-l border-gray-300 text-gray-600">Station</th>
                                        <th rowSpan="2" className="p-1 border-b border-l border-gray-300 w-[60px] min-w-[60px] sticky right-0 bg-gray-50 z-50 text-gray-600 shadow-[-2px_0_5px_rgba(0,0,0,0.1)]">JUDGE<br /><span className="text-[0.8em] text-gray-400 font-normal">TIME</span></th>
                                    </tr>
                                    <tr>
                                        {stationColumns.map(num => <th key={num} className="p-1 border-b border-gray-300 w-7 min-w-[26px] border-l border-gray-300 text-gray-500 text-[0.9em]">{num}</th>)}
                                    </tr>
                                </thead>
                                <tbody className="divide-y divide-gray-200">
                                    {paginatedData.length === 0 ? (
                                        <tr><td colSpan="22" className="p-10 text-gray-500">No data found for the selected model/date.</td></tr>
                                    ) : (
                                        paginatedData.map((row, idx) => {
                                            const isEven = idx % 2 === 0;
                                            const rowBgClass = isEven ? 'bg-slate-50' : 'bg-white';
                                            return (
                                                React.createElement(React.Fragment, { key: idx },
                                                    React.createElement('tr', { className: `${rowBgClass} transition-colors hover:bg-blue-50 group` },
                                                        React.createElement('td', { className: `p-1 text-left font-mono font-bold text-blue-600 sticky left-0 border-r border-gray-200 z-30 align-middle shadow-[2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[75px] min-w-[75px] max-w-[75px]` },
                                                            React.createElement('div', { className: 'text-[1.1em] break-all leading-tight' }, row.frameNo),
                                                            React.createElement('div', { className: 'text-[0.8em] text-gray-400 font-normal mt-0.5 truncate' }, row.model)
                                                        ),
                                                        stationColumns.map(num => {
                                                            const stId = `ST-${num.toString().padStart(2, '0')}`;
                                                            const status = row.stations[stId];
                                                            const { content, className } = getStatusDisplay(status);
                                                            return React.createElement('td', { key: `st-${stId}`, className: 'p-[2px] border-l border-gray-200 align-middle' },
                                                                React.createElement('div', { className: `w-full h-8 flex items-center justify-center rounded ${className} text-[0.8em]` }, content)
                                                            );
                                                        }),
                                                        React.createElement('td', { className: `p-1 sticky right-0 z-30 border-l border-gray-200 font-bold align-middle shadow-[-2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[60px] min-w-[60px]` },
                                                            React.createElement('div', { className: `mx-auto px-1 py-1 rounded w-full h-6 flex items-center justify-center text-[0.9em] ${row.judge === 'NG' ? 'bg-red-100 text-red-600 border border-red-200' : 'text-green-600'}` }, row.judge)
                                                        )
                                                    ),
                                                    React.createElement('tr', { className: `${rowBgClass} border-b border-gray-200 group` },
                                                        React.createElement('td', { className: `p-1 text-right text-[0.8em] text-gray-400 sticky left-0 border-r border-gray-200 z-30 font-mono shadow-[2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[75px] min-w-[75px] max-w-[75px]` }, 'T(s)'),
                                                        stationColumns.map(num => {
                                                            const stId = `ST-${num.toString().padStart(2, '0')}`;
                                                            const time = row.stationTimes[stId];
                                                            return React.createElement('td', { key: `time-${stId}`, className: 'p-[2px] border-l border-gray-200 text-[0.8em] text-gray-500 font-mono' }, time);
                                                        }),
                                                        React.createElement('td', { className: `p-1 sticky right-0 z-30 border-l border-gray-200 align-middle text-right font-mono text-[0.9em] text-slate-800 shadow-[-2px_0_5px_rgba(0,0,0,0.05)] ${rowBgClass} w-[60px] min-w-[60px]` },
                                                            React.createElement('div', { className: 'pr-1' }, `${row.totalTime}s`)
                                                        )
                                                    )
                                                )
                                            );
                                        })
                                    )}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div className="flex flex-wrap justify-between items-center bg-white p-3 rounded-lg border text-[0.8em]">
                        <div className="flex items-center gap-3 text-gray-500">
                            <span>Show</span>
                            <select value={rowsPerPage} onChange={(e) => { setRowsPerPage(Number(e.target.value)); setCurrentPage(1); }} className="bg-gray-50 border border-gray-300 rounded px-2 py-1 focus:outline-none text-slate-800">
                                <option value="10">10</option>
                                <option value="20">20</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                            <span>rows / page</span>
                            <span className="border-l border-gray-300 pl-3">Total {filteredData.length} records</span>
                        </div>
                        <div className="flex items-center gap-1">
                            <button onClick={() => setCurrentPage(1)} disabled={currentPage === 1} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚èÆ</button>
                            <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚óÄ</button>
                            <span className="text-slate-800 font-mono bg-gray-50 px-2 py-1 rounded border border-gray-300 min-w-[30px] text-center">{currentPage}</span>
                            <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚ñ∂</button>
                            <button onClick={() => setCurrentPage(totalPages)} disabled={currentPage === totalPages} className="p-1 rounded hover:bg-gray-100 text-gray-500 disabled:opacity-30">‚è≠</button>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ STATION HMI COMPONENT ============
        const StationHMI = ({ station, onBack }) => {
            if (!station) return <div className="text-white p-10">Station not found</div>;
            const getStatusColor = (status) => {
                switch (status) {
                    case StationStatus.OK: return 'bg-green-500';
                    case StationStatus.NG: return 'bg-red-600';
                    case StationStatus.RUNNING: return 'bg-blue-600';
                    default: return 'bg-gray-600';
                }
            };

            return (
                <div className="fixed inset-0 bg-black text-white flex flex-col z-50">
                    <div className="h-16 bg-gray-900 flex items-center justify-between px-6 border-b border-gray-700">
                        <button onClick={onBack} className="bg-gray-700 hover:bg-gray-600 p-2 rounded font-bold">‚Üê BACK</button>
                        <div className="text-2xl font-bold">{station.name}</div>
                        <div className="text-gray-400 text-sm">{new Date().toLocaleTimeString()}</div>
                    </div>
                    <div className="flex-1 flex p-4 gap-4">
                        <div className="w-1/2">
                            <div className={`h-full rounded-xl flex items-center justify-center ${getStatusColor(station.status)}`}>
                                <div className="text-center">
                                    <div className="text-8xl font-black uppercase">{station.status}</div>
                                    <div className="text-2xl mt-4 opacity-80">Current State</div>
                                </div>
                            </div>
                        </div>
                        <div className="w-1/2 bg-gray-900 rounded-xl p-6 flex flex-col justify-center">
                            <div className="flex justify-between border-b border-gray-600 pb-4 mb-4">
                                <span className="text-gray-400 text-xl">Model</span>
                                <span className="text-3xl font-mono font-bold text-blue-400">{station.currentModel}</span>
                            </div>
                            <div className="flex justify-between border-b border-gray-600 pb-4 mb-4">
                                <span className="text-gray-400 text-xl">Cycle Time</span>
                                <div><span className="text-6xl font-mono font-bold">{station.cycleTime.toFixed(1)}</span><span className="text-gray-500 ml-2">sec</span></div>
                            </div>
                            <div className="flex justify-between border-b border-gray-600 pb-4 mb-4">
                                <span className="text-gray-400 text-xl">Total Status</span>
                                <div><span className="text-6xl font-mono font-bold">{station.totalCount}</span><span className="text-gray-500 ml-2">Process</span></div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="bg-gray-800 p-3 rounded">
                                    <div className="text-gray-400 text-sm">OK Count</div>
                                    <div className="text-3xl font-mono font-bold text-green-500">{station.totalCount - station.ngCount}</div>
                                </div>
                                <div className="bg-gray-800 p-3 rounded">
                                    <div className="text-gray-400 text-sm">NG Count</div>
                                    <div className="text-3xl font-mono font-bold text-red-500">{station.ngCount}</div>
                                </div>
                                <div className="bg-gray-800 p-3 rounded">
                                    <div className="text-gray-400 text-sm">Skip Count</div>
                                    <div className="text-3xl font-mono font-bold text-yellow-500">0</div>
                                </div>
                                <div className="bg-gray-800 p-3 rounded">
                                    <div className="text-gray-400 text-sm">By Pass Count</div>
                                    <div className="text-3xl font-mono font-bold text-blue-500">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // ============ MAIN APP ============
        const App = () => {
            const [stations, setStations] = useState(generateInitialStations());
            const [currentPage, setCurrentPage] = useState('dashboard');
            const [selectedStation, setSelectedStation] = useState(null);
            const [isMenuCollapsed, setIsMenuCollapsed] = useState(false); // State for menu collapse

            useEffect(() => {
                const interval = setInterval(() => {
                    setStations(prev => simulateLiveUpdate(prev));
                }, 2000);
                return () => clearInterval(interval);
            }, []);

            const renderPage = () => {
                if (selectedStation) {
                    return <StationHMI station={selectedStation} onBack={() => setSelectedStation(null)} />;
                }
                switch (currentPage) {
                    case 'dashboard': return <DashboardTV stations={stations} />;
                    case 'layout': return <LayoutMap stations={stations} onStationClick={setSelectedStation} />;
                    case 'report': return <ReportData stations={stations} />;
                    default: return <DashboardTV stations={stations} />;
                }
            };

            if (selectedStation) return renderPage();

            return (
                <div className="flex h-screen">
                    {/* Sidebar with dynamic width based on collapsed state */}
                    <aside className={`bg-white border-r flex flex-col transition-all duration-300 ${isMenuCollapsed ? 'w-20' : 'w-64'}`}>
                        {/* Logo and user interaction for toggling menu */}
                        <div
                            className="h-16 flex items-center px-4 border-b cursor-pointer hover:bg-gray-50 transition-colors"
                            onClick={() => setIsMenuCollapsed(!isMenuCollapsed)}
                            title="Click to toggle menu"
                        >
                            <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/7/7b/Honda_Logo.svg/2552px-Honda_Logo.svg.png" alt="Honda" className="w-10 h-10 mr-2 flex-shrink-0" />
                            {!isMenuCollapsed && <span className="font-bold text-lg whitespace-nowrap overflow-hidden">Interlock Line 1</span>}
                        </div>

                        <nav className="flex-1 p-3">
                            <button onClick={() => setCurrentPage('dashboard')} className={`w-full text-left p-3 rounded mb-2 flex items-center gap-3 ${currentPage === 'dashboard' ? 'bg-blue-50 text-blue-600 font-bold' : 'hover:bg-gray-100'}`} title="Dashboard">
                                <span className="text-xl">üì∫</span>
                                {!isMenuCollapsed && <span>TV Dashboard</span>}
                            </button>
                            <button onClick={() => setCurrentPage('layout')} className={`w-full text-left p-3 rounded mb-2 flex items-center gap-3 ${currentPage === 'layout' ? 'bg-blue-50 text-blue-600 font-bold' : 'hover:bg-gray-100'}`} title="Factory Layout">
                                <span className="text-xl">üó∫Ô∏è</span>
                                {!isMenuCollapsed && <span>Factory Layout</span>}
                            </button>
                            <button onClick={() => setCurrentPage('report')} className={`w-full text-left p-3 rounded mb-2 flex items-center gap-3 ${currentPage === 'report' ? 'bg-blue-50 text-blue-600 font-bold' : 'hover:bg-gray-100'}`} title="Production Report">
                                <span className="text-xl">üìÑ</span>
                                {!isMenuCollapsed && <span>Production Report</span>}
                            </button>
                        </nav>

                        <div className="p-4 border-t">
                            <div className="flex items-center gap-2 justify-center lg:justify-start">
                                <div className="w-2 h-2 rounded-full bg-green-500 animate-pulse flex-shrink-0"></div>
                                {!isMenuCollapsed && <span className="text-xs text-gray-500 whitespace-nowrap">System Online</span>}
                            </div>
                        </div>
                    </aside>
                    <main className="flex-1 flex flex-col overflow-hidden">
                        <header className="h-16 bg-white border-b flex items-center justify-between px-6">
                            <h1 className="text-xl font-bold">
                                {currentPage === 'dashboard' && 'Main Production Overview'}
                                {currentPage === 'layout' && 'Interactive Factory Layout'}
                                {currentPage === 'report' && 'Production Data Logs'}
                            </h1>
                            <div className="text-right">
                                <div className="text-sm font-bold">{new Date().toLocaleTimeString()}</div>
                                <div className="text-xs text-gray-500">{new Date().toLocaleDateString()}</div>
                            </div>
                        </header>

                        {/* Modified container for layout page to remove padding/margins if needed */}
                        <div className={`flex-1 overflow-hidden ${currentPage === 'layout' ? 'p-0' : ''}`}>
                            {renderPage()}
                        </div>
                    </main>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>

</html>